3:I[78703,[],""]
6:I[53751,[],""]
7:I[59576,["706","static/chunks/706-97ed238ee5a03fb5.js","469","static/chunks/469-7ee2e4c850f58403.js","911","static/chunks/911-e9f556f9b03e931c.js","373","static/chunks/373-fbdb9516436dc720.js","203","static/chunks/app/%5Blocale%5D/layout-3df2a5079cf0a3bb.js"],"Providers"]
4:["locale","zh-cn","d"]
5:["slug","emacs-line-number","d"]
0:["WzUIVLI3g2-0LVoiFyHvt",[[["",{"children":[["locale","zh-cn","d"],{"children":["posts",{"children":[["slug","emacs-line-number","d"],{"children":["__PAGE__?{\"locale\":\"zh-cn\",\"slug\":\"emacs-line-number\"}",{}]}]}]}]},"$undefined","$undefined",true],["",{"children":[["locale","zh-cn","d"],{"children":["posts",{"children":[["slug","emacs-line-number","d"],{"children":["__PAGE__",{},[["$L1","$L2"],null],null]},[["$","div",null,{"className":" relative w-full py-12 shadow-xl shadow-slate-700/20 ring-1 ring-gray-900/5 dark:shadow-slate-100/20 dark:ring-gray-100/5 lg:mx-auto lg:max-w-4xl lg:pt-16 lg:pb-28 bg-lightwhite dark:bg-lightblack","children":["$","div",null,{"className":"prose prose-natural dark:prose-invert mx-auto max-w-full px-8 sm:px-16 relative","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","$4","children","posts","children","$5","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/97d548e729a05adf.css","precedence":"next","crossOrigin":"$undefined"}]]}]}]}],null],null]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","$4","children","posts","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}],null]},[["$","html",null,{"lang":"zh-cn","suppressHydrationWarning":true,"children":["$","body",null,{"className":"text-foreground bg-background min-h-screen","children":["$","$L7",null,{"children":["$L8",["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]}]}]}],null],null]},[["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/57e8d276a38ab64c.css","precedence":"next","crossOrigin":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/ad2762ca96cee671.css","precedence":"next","crossOrigin":"$undefined"}]]}],null],null],[null,"$L9"]]]]
a:I[53693,["706","static/chunks/706-97ed238ee5a03fb5.js","469","static/chunks/469-7ee2e4c850f58403.js","911","static/chunks/911-e9f556f9b03e931c.js","373","static/chunks/373-fbdb9516436dc720.js","203","static/chunks/app/%5Blocale%5D/layout-3df2a5079cf0a3bb.js"],"Navbar"]
b:I[53693,["706","static/chunks/706-97ed238ee5a03fb5.js","469","static/chunks/469-7ee2e4c850f58403.js","911","static/chunks/911-e9f556f9b03e931c.js","373","static/chunks/373-fbdb9516436dc720.js","203","static/chunks/app/%5Blocale%5D/layout-3df2a5079cf0a3bb.js"],"NavbarBrand"]
d:I[53693,["706","static/chunks/706-97ed238ee5a03fb5.js","469","static/chunks/469-7ee2e4c850f58403.js","911","static/chunks/911-e9f556f9b03e931c.js","373","static/chunks/373-fbdb9516436dc720.js","203","static/chunks/app/%5Blocale%5D/layout-3df2a5079cf0a3bb.js"],"NavbarItem"]
10:I[53693,["706","static/chunks/706-97ed238ee5a03fb5.js","469","static/chunks/469-7ee2e4c850f58403.js","911","static/chunks/911-e9f556f9b03e931c.js","373","static/chunks/373-fbdb9516436dc720.js","203","static/chunks/app/%5Blocale%5D/layout-3df2a5079cf0a3bb.js"],"NavbarContent"]
11:I[81946,["706","static/chunks/706-97ed238ee5a03fb5.js","469","static/chunks/469-7ee2e4c850f58403.js","911","static/chunks/911-e9f556f9b03e931c.js","373","static/chunks/373-fbdb9516436dc720.js","203","static/chunks/app/%5Blocale%5D/layout-3df2a5079cf0a3bb.js"],"default"]
12:I[48125,["706","static/chunks/706-97ed238ee5a03fb5.js","469","static/chunks/469-7ee2e4c850f58403.js","911","static/chunks/911-e9f556f9b03e931c.js","373","static/chunks/373-fbdb9516436dc720.js","203","static/chunks/app/%5Blocale%5D/layout-3df2a5079cf0a3bb.js"],"default"]
8:["$","$La",null,{"shouldHideOnScroll":true,"children":[["$","$Lb",null,{"className":"flex flex-row gap-4","children":[["$","p",null,{"className":"font-bold text-inherit","children":"$Lc"}],["$","$Ld",null,{"children":"$Le"}],["$","$Ld",null,{"children":"$Lf"}]]}],["$","$L10",null,{"justify":"end","className":"gap-1","children":[["$","$Ld",null,{"children":["$","$L11",null,{}]}],["$","$Ld",null,{"children":["$","$L12",null,{}]}]]}]]}]
9:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Aya's Blog"}],["$","meta","3",{"name":"description","content":"A site powered by next.js and pandoc"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"48x48"}]]
1:null
13:I[9678,["706","static/chunks/706-97ed238ee5a03fb5.js","469","static/chunks/469-7ee2e4c850f58403.js","911","static/chunks/911-e9f556f9b03e931c.js","373","static/chunks/373-fbdb9516436dc720.js","203","static/chunks/app/%5Blocale%5D/layout-3df2a5079cf0a3bb.js"],"default"]
c:["$","$L13",null,{"locale":"zh-cn","localePrefix":"always","href":"/","aria-label":"主页","children":"主页"}]
e:["$","$L13",null,{"locale":"zh-cn","localePrefix":"always","href":"/blog/","className":"font-bold","aria-label":"博客","children":"博客"}]
f:["$","$L13",null,{"locale":"zh-cn","localePrefix":"always","href":"/favorites/","className":"font-bold","aria-label":"园地","children":"园地"}]
14:"$Sreact.fragment"
15:I[75164,["645","static/chunks/61af6f7f-9cff01d0fc100f98.js","469","static/chunks/469-7ee2e4c850f58403.js","306","static/chunks/306-ef157ce75cbf9e7a.js","827","static/chunks/app/%5Blocale%5D/posts/%5Bslug%5D/page-8ab52a4fba20768e.js"],"default"]
16:I[65469,["645","static/chunks/61af6f7f-9cff01d0fc100f98.js","469","static/chunks/469-7ee2e4c850f58403.js","306","static/chunks/306-ef157ce75cbf9e7a.js","827","static/chunks/app/%5Blocale%5D/posts/%5Bslug%5D/page-8ab52a4fba20768e.js"],""]
17:I[39926,["645","static/chunks/61af6f7f-9cff01d0fc100f98.js","469","static/chunks/469-7ee2e4c850f58403.js","306","static/chunks/306-ef157ce75cbf9e7a.js","827","static/chunks/app/%5Blocale%5D/posts/%5Bslug%5D/page-8ab52a4fba20768e.js"],"default"]
19:I[27377,["645","static/chunks/61af6f7f-9cff01d0fc100f98.js","469","static/chunks/469-7ee2e4c850f58403.js","306","static/chunks/306-ef157ce75cbf9e7a.js","827","static/chunks/app/%5Blocale%5D/posts/%5Bslug%5D/page-8ab52a4fba20768e.js"],"default"]
18:T899,(defun spacemacs//linum-enabled-for-current-major-mode ()
  "Return non-nil if line number is enabled for current major-mode."
  (let* ((disabled-for-modes
          (spacemacs/mplist-get-values dotspacemacs-line-numbers
                                       :disabled-for-modes))
         (user-enabled-for-modes
          (spacemacs/mplist-get-values dotspacemacs-line-numbers
                                       :enabled-for-modes))
         ;; default `enabled-for-modes' to '(prog-mode text-mode), because it is
         ;; a more sensible default than enabling in all buffers - including
         ;; Magit buffers, terminal buffers, etc. But don't include prog-mode or
         ;; text-mode if they're explicitly disabled by user
         (enabled-for-modes (or user-enabled-for-modes
                                (seq-difference '(prog-mode text-mode)
                                                disabled-for-modes
                                                #'eq)))
         (enabled-for-parent (or (and (equal enabled-for-modes '(all)) 'all)
                                 (apply #'derived-mode-p enabled-for-modes)))
         (disabled-for-parent (apply #'derived-mode-p disabled-for-modes)))
    (or
     ;; special case 'all: enable for any mode that isn't specifically disabled
     (and (eq enabled-for-parent 'all) (not disabled-for-parent))
     ;; current mode or a parent is in :enabled-for-modes, and there isn't a
     ;; more specific parent (or the mode itself) in :disabled-for-modes
     (and enabled-for-parent
          (or (not disabled-for-parent)
              ;; handles the case where current major-mode has a parent both in
              ;; :enabled-for-modes and in :disabled-for-modes. Return non-nil
              ;; if enabled-for-parent is the more specific parent (IOW derives
              ;; from disabled-for-parent)
              (spacemacs/derived-mode-p enabled-for-parent disabled-for-parent)))
     ;; current mode (or parent) not explicitly disabled
     (and (null user-enabled-for-modes)
          enabled-for-parent            ; mode is one of default allowed modes
          disabled-for-modes
          (not disabled-for-parent)))))2:["$","div",null,{"children":[["$","h1",null,{"className":"text-4xl font-bold mb-2","children":"在 coq-mode 下开启行号显示"}],["$","div",null,{"className":"text-sm text-gray-500 mb-5","children":"12/4/2023"}],["$","$14","0",{"children":[["$","$L15",null,{"children":[["$","ul","0",{"children":[["$","li","0",{"children":[["$","a","0",{"href":"#问题是什么","id":"toc-问题是什么","children":["问题是什么"]}]]}],["$","li","1",{"children":[["$","a","0",{"href":"#临时解决方案","id":"toc-临时解决方案","children":["临时解决方案"]}]]}],["$","li","2",{"children":[["$","a","0",{"href":"#为什么","id":"toc-为什么","children":["为什么"]}]]}],["$","li","3",{"children":[["$","a","0",{"href":"#最终解决方案","id":"toc-最终解决方案","children":["最终解决方案"]}]]}]]}]]}],["$","article","1",{"children":[["$","p",null,{"children":["行号（Line"," ","Number）的显示，似乎不应该成为一个问题。vscode"," ",["$","span","0",{"className":"cjk","children":["仓库里还有一个"]}]," ",["$","a","1",{"href":"https://github.com/Microsoft/vscode/issues/52735","children":["issue"]}]," ",["$","span","2",{"className":"cjk","children":["在询问怎么方便地关闭行号显示。而对于"]}]," ","Vim"," ",["$","span","3",{"className":"cjk","children":["用户来说，一句"]}]," ",["$","code","4",{"children":["set :number"]}]," ",["$","span","5",{"className":"cjk","children":["就可以开启行号显示。"]}]]}],["$","p",null,{"children":["没错，Emacs"," ",["$","span","0",{"className":"cjk","children":["就是这么特别的编辑器。对我这样偶尔用一用的用户来说，行号显示也确实是一个困扰我的问题。"]}]]}],["$","h2",null,{"className":"text-3xl","id":"问题是什么","children":[["$","$L16",null,{"href":"#问题是什么","color":"secondary","className":"pr-3 no-underline hover:underline text-primary font-sans","children":"#"}],[["$","span","0",{"className":"cjk","children":["问题是什么"]}]]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["我使用的是一个"]}]," ","Emacs"," ",["$","span","1",{"className":"cjk","children":["的发行版，或者说一个比较成熟的配置文件，"]}],["$","a","2",{"href":"https://www.spacemacs.org/","children":["Spacemacs"]}],"."," ",["$","span","3",{"className":"cjk","children":["在"]}]," ","Spacemacs"," ",["$","span","4",{"className":"cjk","children":["的官方文档里，要开启行号显示，似乎只需要在"]}]," ",["$","code","5",{"children":[".spacemacs"]}]," ",["$","span","6",{"className":"cjk","children":["里设置一下变量就可以了："]}]]}],["$","$L17","4",{"className":"elisp","children":["(setq-default dotspacemacs-line-numbers t)"]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["这句话的意思就是，把"]}]," ",["$","code","1",{"children":["dotspacemacs-line-numbers"]}]," ",["$","span","2",{"className":"cjk","children":["设置为"]}]," ",["$","code","3",{"children":["t"]}],"."]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["同时，为了支持"]}]," ","coq"," ",["$","span","1",{"className":"cjk","children":["语言，我还装载了"]}]," ",["$","code","2",{"children":["coq"]}]," ","层（layer）."," ",["$","span","3",{"className":"cjk","children":["但如果打开一个"]}]," ","coq"," ",["$","span","4",{"className":"cjk","children":["文件，你也许会惊奇地发现，这时"]}]," ","coq"," ",["$","span","5",{"className":"cjk","children":["源代码是没有行号的："]}]]}],["$","figure","7",{"children":[["$","div",null,{"children":[["$","img","0",{"src":"https://pic.superbed.cc/item/656efcb312f8d922c1008d4a.png"}]]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["按照正常的直觉，设置为"]}]," ",["$","code","1",{"children":["t"]}]," ",["$","span","2",{"className":"cjk","children":["应该是会在所有情况下显示行号的。那么，为什么没有显示行号呢？"]}]]}],["$","h2",null,{"className":"text-3xl","id":"临时解决方案","children":[["$","$L16",null,{"href":"#临时解决方案","color":"secondary","className":"pr-3 no-underline hover:underline text-primary font-sans","children":"#"}],[["$","span","0",{"className":"cjk","children":["临时解决方案"]}]]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["解决这个问题，其实比搞清楚原因要容易。"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["稍加搜索，我发现"]}]," ",["$","code","1",{"children":["spc t n"]}]," ",["$","sup","2",{"children":[["$","a","0",{"href":"#note-1","id":"note-anchor-1","children":["1"]}]]}],["$","span","3",{"className":"cjk","children":["可以在当前"]}]," ","buffer"," ",["$","span","4",{"className":"cjk","children":["打开行号，这确实可以解决问题。按照"]}]," ","Emacs"," ","wiki"," ",["$","span","5",{"className":"cjk","children":["的说法，这个快捷键调用的实际上是"]}]," ","Emacs"," ","26.1"," ",["$","span","6",{"className":"cjk","children":["版本后引入的行号命令"]}]," ",["$","code","7",{"children":["display-line-numbers-mode"]}],"."]}],["$","p",null,{"children":["Emacs"," ",["$","span","0",{"className":"cjk","children":["的命令可以通过"]}]," ",["$","code","1",{"children":["m-x"]}],["$","span","2",{"className":"cjk","children":["，或者"]}]," ",["$","code","3",{"children":["spc spc"]}]," ",["$","span","4",{"className":"cjk","children":["执行。实际上，一个命令就是一个"]}]," ","Emacs"," ","Lisp"," ",["$","span","5",{"className":"cjk","children":["的函数，参考"]}]," ","Programming"," ","Elisp"," ",["$","span","6",{"className":"cjk","children":["的"]}],["$","a","7",{"href":"https://www.gnu.org/software/emacs/manual/html_node/eintr/Interactive-multiply_002dby_002dseven.html","children":[["$","span","0",{"className":"cjk","children":["文档"]}]]}],["$","span","8",{"className":"cjk","children":["，只要一个函数的函数定义里有"]}]," ",["$","code","9",{"children":["(interactive)"]}],["$","span","10",{"className":"cjk","children":["，那么它就可以当成一个命令调用。"]}]]}],["$","p",null,{"children":["显然，Spacemacs"," ","也是通过这个函数进行行号相关设置。虽然不知道因为什么原因，Spacemacs"," ",["$","span","0",{"className":"cjk","children":["没有给我的"]}]," ",["$","code","1",{"children":[".v"]}]," ",["$","span","2",{"className":"cjk","children":["文件开启行号，但是我们可以自己开启。"]}]]}],["$","p",null,{"children":[["$","code","0",{"children":["coq"]}]," ",["$","span","1",{"className":"cjk","children":["层实际上使用了"]}]," ",["$","code","2",{"children":["coq-mode"]}],"."," ",["$","code","3",{"children":["coq-mode"]}]," ",["$","span","4",{"className":"cjk","children":["是一个"]}]," ","Emacs"," ",["$","span","5",{"className":"cjk","children":["的"]}],["$","a","6",{"href":"https://www.gnu.org/software/emacs/manual/html_node/emacs/Major-Modes.html","children":["主模式（Major"," ","Mode）"]}],["$","span","7",{"className":"cjk","children":["，它给"]}]," ","coq"," ",["$","span","8",{"className":"cjk","children":["语言提供了支持，并定义了一大堆快捷键。"]}]]}],["$","p",null,{"children":["Emacs"," ",["$","span","0",{"className":"cjk","children":["支持一种叫做"]}]," ",["$","a","1",{"href":"https://www.gnu.org/software/emacs/manual/html_node/emacs/Hooks.html","children":["Hooks"]}]," ",["$","span","2",{"className":"cjk","children":["的机制，它允许我们在某个模式加载时，执行一系列操作。既然"]}]," ","Spacemacs"," ",["$","span","3",{"className":"cjk","children":["不会给"]}]," ",["$","code","4",{"children":["coq-mode"]}]," ",["$","span","5",{"className":"cjk","children":["开启行号，我们就通过这种机制手动执行"]}]," ",["$","code","6",{"children":["display-line-numbers-mode"]}],"."]}],["$","$L17","16",{"className":"elisp","children":["(defun dotspacemacs/user-config ()\n  \"Configuration for user code:\nThis function is called at the very end of Spacemacs startup, after layer\nconfiguration.\nPut your configuration code here, except for variables that should be set\nbefore packages are loaded.\"\n  (add-hook 'coq-mode-hook (lambda () (display-line-numbers-mode 1)))\n)"]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["这里的"]}]," ",["$","code","1",{"children":["dotspacemacs/user-config"]}]," ",["$","span","2",{"className":"cjk","children":["是"]}]," ","Spacemacs"," ",["$","span","3",{"className":"cjk","children":["配置文件的一部分，在这里可以执行一些自定义操作。"]}]]}],["$","p",null,{"children":["这当然就解决了问题。其实，Spacemacs"," ",["$","span","0",{"className":"cjk","children":["在文档里还提到了一个选项"]}]," ",["$","code","1",{"children":[":enabled-for-modes"]}],"."," ",["$","span","2",{"className":"cjk","children":["在这个选项里加上"]}]," ",["$","code","3",{"children":["coq-mode"]}]," ",["$","span","4",{"className":"cjk","children":["可以直接解决问题。不过我直到搞清楚了问题的来源，才发现了有这个选项。"]}]]}],["$","$L17","19",{"className":"elisp","children":["(setq-default dotspacemacs-line-numbers\n  '(:enabled-for-modes coq-mode))"]}],["$","h2",null,{"className":"text-3xl","id":"为什么","children":[["$","$L16",null,{"href":"#为什么","color":"secondary","className":"pr-3 no-underline hover:underline text-primary font-sans","children":"#"}],[["$","span","0",{"className":"cjk","children":["为什么"]}]]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["我首先注意到的是"]}]," ",["$","code","1",{"children":["dotspacemacs-line-numbers"]}]," ",["$","span","2",{"className":"cjk","children":["的注释："]}]]}],["$","$L17","22",{"className":"elisp","children":[";; Control line numbers activation.\n;; If set to `t', `relative' or `visual' then line numbers are enabled in all\n;; `prog-mode' and `text-mode' derivatives. If set to `relative', line\n;; numbers are relative. If set to `visual', line numbers are also relative,\n;; but only visual lines are counted. For example, folded lines will not be\n;; counted and wrapped lines are counted as multiple lines.\n;; This variable can also be set to a property list for finer control:\n;; (default nil)"]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["这段注释里提到，如果把这个变量设置为"]}]," ",["$","code","1",{"children":["t"]}],["$","span","2",{"className":"cjk","children":["，那么它会默认在"]}]," ",["$","code","3",{"children":["prog-mode"]}]," ",["$","span","4",{"className":"cjk","children":["和"]}]," ",["$","code","5",{"children":["text-mode"]}]," ",["$","span","6",{"className":"cjk","children":["里开启行号。这两个"]}]," ","mode"," ",["$","span","7",{"className":"cjk","children":["被称为"]}]," ",["$","a","8",{"href":"https://www.gnu.org/software/emacs/manual/html_node/elisp/Basic-Major-Modes.html","children":["Basic"," ","Major"," ","Mode"]}],"."," ","一个很自然的猜想是,"," ",["$","code","9",{"children":["coq-mode"]}]," ",["$","span","10",{"className":"cjk","children":["不是它们之一。"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["打开一个"]}]," ","coq"," ",["$","span","1",{"className":"cjk","children":["文件，执行"]}]," ",["$","code","2",{"children":["m-x describe-mode"]}],["$","span","3",{"className":"cjk","children":["，会看到："]}]]}],["$","$L17","25",{"children":["Coq mode defined in ‘coq-mode.el’:\nMajor mode for Coq scripts."]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["进入"]}]," ",["$","code","1",{"children":["coq-mode.el"]}]," ",["$","span","2",{"className":"cjk","children":["的源代码查看一下，玄机就在第"]}]," ","182"," ",["$","span","3",{"className":"cjk","children":["行："]}]]}],["$","$L17","27",{"className":"elisp","children":["(defun coq--parent-mode ()\n  (if coq-use-pg (proof-mode) (prog-mode)))\n\n;;;###autoload\n(define-derived-mode coq-mode coq--parent-mode \"Coq\"\n  \"Major mode for Coq scripts."]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["这个"]}]," ",["$","code","1",{"children":["coq--parent-mode"]}]," ",["$","span","2",{"className":"cjk","children":["显然就是"]}]," ",["$","code","3",{"children":["coq-mode"]}]," ","的父模式（parent"," ","mode），Emasc"," ",["$","span","4",{"className":"cjk","children":["的模式也有一个继承树，一个模式继承另一个父模式，这棵树的根不确定，有几种情况："]}]]}],["$","ul","29",{"children":[["$","li","0",{"children":[["$","span","0",{"className":"cjk","children":["自己"]}]]}],["$","li","1",{"children":["Fundamental"," ","Mode"]}],["$","li","2",{"children":["Basic"," ","Major"," ","Mode"]}]]}],["$","p",null,{"children":[["$","code","0",{"children":["coq-use-pg"]}]," ",["$","span","1",{"className":"cjk","children":["的值在我的环境里为"]}]," ",["$","code","2",{"children":["t"]}],["$","span","3",{"className":"cjk","children":["，它的父模式是"]}]," ",["$","code","4",{"children":["proof-mode"]}],"."," ",["$","code","5",{"children":["proof-mode"]}]," ",["$","span","6",{"className":"cjk","children":["的父模式又是什么呢？"]}]]}],["$","p",null,{"children":["StackOverflow"," ",["$","span","0",{"className":"cjk","children":["的"]}],["$","a","1",{"href":"https://emacs.stackexchange.com/questions/58073/how-to-find-inheritance-of-modes","children":[["$","span","0",{"className":"cjk","children":["一个问题"]}]]}],["$","span","2",{"className":"cjk","children":["提供了相关代码："]}]]}],["$","$L17","32",{"className":"elisp","children":["(defun derived-modes (mode)\n  \"Return a list of the ancestor modes that MODE is derived from.\"\n  (let ((modes   ())\n        (parent  nil))\n    (while (setq parent (get mode 'derived-mode-parent))\n      (push parent modes)\n      (setq mode parent))\n    (setq modes  (nreverse modes))))"]}],["$","p",null,{"children":["用这个函数，确实可以得到一些“正常”模式的继承路径，比如我们刚刚说的"," ",["$","code","0",{"children":["proof-mode"]}],":"]}],["$","$L17","34",{"className":"elisp","children":["ELISP> (derived-modes 'proof-mode)\n(prog-mode)"]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["是的，"]}],["$","code","1",{"children":["proof-mode"]}]," ",["$","span","2",{"className":"cjk","children":["的父模式就是"]}]," ",["$","code","3",{"children":["prog-mode"]}],"."," ",["$","span","4",{"className":"cjk","children":["如果你还记得刚才的文档的话，"]}],["$","code","5",{"children":["prog-mode"]}]," ",["$","span","6",{"className":"cjk","children":["在"]}]," ",["$","code","7",{"children":["dotspacemacs-line-numbers"]}]," ",["$","span","8",{"className":"cjk","children":["设置为"]}]," ",["$","code","9",{"children":["t"]}]," ",["$","span","10",{"className":"cjk","children":["的时候也应该显示行号。"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["那么，究竟是什么地方错了呢？不妨给这个函数输入"]}]," ",["$","code","1",{"children":["'coq-mode"]}],":"]}],["$","$L17","37",{"className":"elisp","children":["ELISP> (derived-modes 'coq-mode)\n(coq--parent-mode)"]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["它的输出是"]}]," ",["$","code","1",{"children":["(coq--parent-mode)"]}],["$","span","2",{"className":"cjk","children":["，这只是父模式的符号，而不是求值后的父模式。可见，"]}],["$","code","3",{"children":["(get 'coq-mode 'derived-parent-mode)"]}]," ",["$","span","4",{"className":"cjk","children":["这个表达式只能拿到语法上的符号，而非它真正的父模式。检查"]}]," ",["$","code","5",{"children":["define-derived-mode"]}]," ",["$","span","6",{"className":"cjk","children":["的源代码，可以发现"]}]," ",["$","code","7",{"children":["(get mode 'derived-mode-parent)"]}]," ",["$","span","8",{"className":"cjk","children":["拿到的是这句话设置的父模式："]}]]}],["$","$L17","39",{"className":"elisp","children":["(put ',child 'derived-mode-parent ',parent)"]}],["$","p",null,{"children":["那么，Spacemacs"," ","是这样得到父模式的吗？Spacemacs"," ",["$","span","0",{"className":"cjk","children":["在"]}]," ",["$","code","1",{"children":["spacemacs/layers/+spacemacs/spacemacs-defaults/funcs.el"]}]," ",["$","span","2",{"className":"cjk","children":["的"]}]," ",["$","code","3",{"children":["spacemacs//linum-enabled-for-current-major-mode"]}]," ",["$","span","4",{"className":"cjk","children":["函数中检查是否在当前模式下开启行号显示："]}]]}],["$","$L17","41",{"className":"elisp","children":["$18"]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["可以看到，它通过"]}]," ",["$","code","1",{"children":["derived-mode-p"]}]," ",["$","span","2",{"className":"cjk","children":["函数询问当前"]}]," ","buffer"," ",["$","span","3",{"className":"cjk","children":["的"]}]," ","major"," ","mode"," ",["$","span","4",{"className":"cjk","children":["是不是预设的"]}]," ",["$","code","5",{"children":["enabled-for-modes"]}]," ",["$","span","6",{"className":"cjk","children":["的子模式。"]}],["$","code","7",{"children":["dervied-mode-p"]}]," ",["$","span","8",{"className":"cjk","children":["是"]}]," ","Emacs"," ",["$","span","9",{"className":"cjk","children":["提供的一个函数，"]}],["$","a","10",{"href":"https://doc.endlessparentheses.com/Fun/derived-mode-p.html","children":[["$","span","0",{"className":"cjk","children":["文档"]}]]}],["$","span","11",{"className":"cjk","children":["声称，如果当前"]}]," ","buffer"," ",["$","span","12",{"className":"cjk","children":["的主模式是"]}]," ",["$","code","13",{"children":["modes"]}]," ",["$","span","14",{"className":"cjk","children":["的子模式，那么"]}]," ",["$","code","15",{"children":["(derived-mode-p modes)"]}]," ",["$","span","16",{"className":"cjk","children":["将返回非"]}]," ",["$","code","17",{"children":["nil"]}]," ",["$","span","18",{"className":"cjk","children":["值。"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["再检查"]}]," ",["$","code","1",{"children":["derived-mode-p"]}]," ",["$","span","2",{"className":"cjk","children":["的源代码，我们终于发现了问题的根源。"]}]]}],["$","$L17","44",{"className":"elisp","children":["(defun provided-mode-derived-p (mode &rest modes)\n  \"Non-nil if MODE is derived from one of MODES or their aliases.\nUses the `derived-mode-parent' property of the symbol to trace backwards.\nIf you just want to check `major-mode', use `derived-mode-p'.\"\n  (while\n      (and\n       (not (memq mode modes))\n       (let* ((parent (get mode 'derived-mode-parent))\n              (parentfn (symbol-function parent)))\n         (setq mode (if (and parentfn (symbolp parentfn)) parentfn parent)))))\n  mode)\n\n(defun derived-mode-p (&rest modes)\n  \"Non-nil if the current major mode is derived from one of MODES.\nUses the `derived-mode-parent' property of the symbol to trace backwards.\"\n  (apply #'provided-mode-derived-p major-mode modes))"]}],["$","p",null,{"children":[["$","code","0",{"children":["dervied-mode-p"]}]," ",["$","span","1",{"className":"cjk","children":["同样通过"]}]," ",["$","code","2",{"children":["(get mode 'derived-mode-parent)"]}]," ",["$","span","3",{"className":"cjk","children":["来得到某个模式的父模式，而这对于"]}]," ",["$","code","4",{"children":["coq-mode"]}]," ",["$","span","5",{"className":"cjk","children":["来说会得到"]}]," ",["$","code","6",{"children":["coq--parent-mode"]}],","," ",["$","span","7",{"className":"cjk","children":["继承链在这里就断了。"]}]]}],["$","p",null,{"children":["Emacs"," ",["$","span","0",{"className":"cjk","children":["中的模式定义最后确实是定义了一个函数。然而，如果"]}]," ",["$","code","1",{"children":["'parent"]}]," ","不能求值出正确的父模式，Emacs"," ",["$","span","2",{"className":"cjk","children":["对于"]}]," ","mode"," ",["$","span","3",{"className":"cjk","children":["的预设函数就会得不到期望的结果。显然，"]}],["$","code","4",{"children":["coq-mode"]}]," ",["$","span","5",{"className":"cjk","children":["不应该这样定义"]}]," ",["$","code","6",{"children":["coq--parent-mode"]}],"."," ",["$","span","7",{"className":"cjk","children":["那么，到底应该怎么定义"]}]," ",["$","code","8",{"children":["coq--parent-mode"]}]," ",["$","span","9",{"className":"cjk","children":["呢？"]}]]}],["$","h2",null,{"className":"text-3xl","id":"最终解决方案","children":[["$","$L16",null,{"href":"#最终解决方案","color":"secondary","className":"pr-3 no-underline hover:underline text-primary font-sans","children":"#"}],[["$","span","0",{"className":"cjk","children":["最终解决方案"]}]]]}],["$","p",null,{"children":["Emacs"," ","Lisp"," ",["$","span","0",{"className":"cjk","children":["的全局变量和全局函数是不同的，这和"]}]," ","Scheme"," ",["$","span","1",{"className":"cjk","children":["很不一样。如果直接把"]}]," ",["$","code","2",{"children":["coq--parent-mode"]}]," ",["$","span","3",{"className":"cjk","children":["定义为一个变量，会使得"]}]," ",["$","code","4",{"children":["coq-mode"]}]," ",["$","span","5",{"className":"cjk","children":["无法加载。"]}]]}],["$","$L17","49",{"className":"elisp","children":["(defvar coq--parent-mode\n  (if coq-use-pg 'proof-mode 'prog-mode))"]}],["$","p",null,{"children":["万幸的是，Emacs"," ","Lisp"," ",["$","span","0",{"className":"cjk","children":["提供了一个叫做"]}]," ",["$","code","1",{"children":["defalias"]}]," ",["$","span","2",{"className":"cjk","children":["的函数，它可以把"]}]," ",["$","code","3",{"children":["coq--parent-mode"]}]," ",["$","span","4",{"className":"cjk","children":["定义为一个"]}]," ","alias."]}],["$","$L17","51",{"className":"elisp","children":["(defalias 'coq--parent-mode\n  (if coq-use-pg 'proof-mode 'prog-mode))"]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["上面的修改就足以使得"]}]," ","Spacemacs"," ",["$","span","1",{"className":"cjk","children":["可以自动侦测到"]}]," ",["$","code","2",{"children":["coq-mode"]}]," ",["$","span","3",{"className":"cjk","children":["派生自"]}]," ",["$","code","4",{"children":["prog-mode"]}],["$","span","5",{"className":"cjk","children":["，从而开启行号显示。我已经提交了一个"]}]," ",["$","a","6",{"href":"https://github.com/ProofGeneral/PG/pull/717","children":["PR"]}],["$","span","7",{"className":"cjk","children":["，并合入了主分支。"]}]]}],["$","div",null,{"className":"notes","children":[["$","$L19",null,{"itemId":"1","id":"note-1","children":[["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["如果你不熟悉这种快捷键记法，可以参考"]}],["$","a","1",{"href":"https://kb.iu.edu/d/aghb","children":[["$","span","0",{"className":"cjk","children":["文档"]}]]}]]}]]}]]}]]}]]}]]}]
