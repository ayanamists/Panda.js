<!DOCTYPE html><html lang="zh-cn"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="https://pic.superbed.cc/item/656efcb312f8d922c1008d4a.png"/><link rel="stylesheet" href="/_next/static/css/2f71e0d51b6954c9.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/cb36c8a6d34b9690.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/ad2762ca96cee671.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/ecc949282143a457.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-4e8d71c3f65c460f.js"/><script src="/_next/static/chunks/1dd3208c-0a1ade3a7807b4cc.js" async=""></script><script src="/_next/static/chunks/286-ccdecb91557a793d.js" async=""></script><script src="/_next/static/chunks/main-app-1543724a55492158.js" async=""></script><script src="/_next/static/chunks/945-45c92e2d248fab37.js" async=""></script><script src="/_next/static/chunks/786-c6fa5cb99b8c7140.js" async=""></script><script src="/_next/static/chunks/807-c8470476b2b24d30.js" async=""></script><script src="/_next/static/chunks/app/%5Blocale%5D/posts/%5Bslug%5D/page-cadedd2465269073.js" async=""></script><script src="/_next/static/chunks/327-1450e5f44eb18d82.js" async=""></script><script src="/_next/static/chunks/256-7bc8f523a9d252a9.js" async=""></script><script src="/_next/static/chunks/app/%5Blocale%5D/layout-54c8e01b9c8af01a.js" async=""></script><title>Aya&#x27;s Blog</title><meta name="description" content="A site powered by next.js and pandoc"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="48x48"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_aaf875 text-foreground bg-background min-h-screen"><div data-overlay-container="true"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&false)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}else{c.add('dark')}if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'dark'}catch(e){}}()</script><nav class="flex z-40 w-full h-auto items-center justify-center data-[menu-open=true]:border-none sticky top-0 inset-x-0 backdrop-blur-lg data-[menu-open=true]:backdrop-blur-xl backdrop-saturate-150 bg-background/70" style="--navbar-height:4rem;transform:none"><header class="z-40 flex px-6 gap-4 w-full flex-row relative flex-nowrap items-center justify-between h-[var(--navbar-height)] max-w-[1024px]"><div class="basis-0 flex-grow flex-nowrap justify-start bg-transparent items-center no-underline text-medium whitespace-nowrap box-border flex flex-row gap-4"><p class="font-bold text-inherit"><a href="/zh-cn">主页</a></p><li class="text-medium whitespace-nowrap box-border list-none data-[active=true]:font-semibold"><a class="font-bold" href="/zh-cn/blog">博客</a></li></div><ul class="flex gap-4 h-full flex-row flex-nowrap items-center data-[justify=start]:justify-start data-[justify=start]:flex-grow data-[justify=start]:basis-0 data-[justify=center]:justify-center data-[justify=end]:justify-end data-[justify=end]:flex-grow data-[justify=end]:basis-0" data-justify="end"><li class="text-medium whitespace-nowrap box-border list-none data-[active=true]:font-semibold"><div data-slot="base" data-filled="true" data-has-value="true" data-has-label="true" class="group inline-flex flex-col relative transition-background motion-reduce:transition-none !duration-150 w-32"><div style="border:0;clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap" aria-hidden="true" data-a11y-ignore="aria-hidden-focus" data-testid="hidden-select-container"><input type="text" tabindex="-1" style="font-size:16px" value="zh-cn"/><label>文/A<select tabindex="-1" size="3"><option></option><option value="en">English</option><option value="zh-cn" selected="">简体中文</option><option value="ja">日本語</option></select></label></div><div data-slot="mainWrapper" class="w-full flex flex-col"><button data-slot="trigger" class="relative px-3 w-full inline-flex shadow-sm tap-highlight-transparent bg-default-100 data-[hover=true]:bg-default-200 group-data-[focus=true]:bg-default-100 rounded-medium flex-col items-start justify-center gap-0 outline-none data-[focus-visible=true]:z-10 data-[focus-visible=true]:outline-2 data-[focus-visible=true]:outline-focus data-[focus-visible=true]:outline-offset-2 h-14 min-h-14 py-2" type="button" id="react-aria-:R1j6fjaH2:" aria-labelledby="react-aria-:R1j6fjaH7: react-aria-:R1j6fjaH3:" aria-describedby="react-aria-:R1j6fjaH5: react-aria-:R1j6fjaH6:" aria-haspopup="listbox" aria-expanded="false"><label data-slot="label" class="block absolute z-10 subpixel-antialiased text-foreground-500 pointer-events-none cursor-pointer will-change-auto origin-top-left rtl:origin-top-right !duration-200 !ease-out transition-[transform,color,left,opacity] motion-reduce:transition-none group-data-[filled=true]:text-default-600 group-data-[filled=true]:pointer-events-auto group-data-[filled=true]:scale-85 text-small group-data-[filled=true]:-translate-y-[calc(50%_+_theme(fontSize.small)/2_-_6px)] pe-2 max-w-full text-ellipsis overflow-hidden" id="react-aria-:R1j6fjaH3:">文/A</label><div data-slot="innerWrapper" class="inline-flex h-full w-[calc(100%_-_theme(spacing.6))] min-h-4 items-center gap-1.5 box-border group-data-[has-label=true]:pt-4"><span data-slot="value" class="text-foreground-500 font-normal w-full text-left rtl:text-right text-small truncate group-data-[has-value=true]:text-default-foreground" id="react-aria-:R1j6fjaH7:">简体中文<div style="border:0;clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap">,</div></span></div><svg aria-hidden="true" fill="none" focusable="false" height="1em" role="presentation" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="1em" data-slot="selectorIcon" class="absolute right-3 rtl:left-3 rtl:right-[unset] w-4 h-4 transition-transform duration-150 ease motion-reduce:transition-none data-[open=true]:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button></div></div></li><li class="text-medium whitespace-nowrap box-border list-none data-[active=true]:font-semibold"></li></ul></header></nav><div class=" relative w-full px-6 py-12 shadow-xl  shadow-slate-700/20 ring-1 ring-gray-900/5 dark:shadow-slate-300/20 dark:ring-gray-100/5 dark:shadow-slate-900/10 md:max-w-3xl md:mx-auto lg:max-w-4xl lg:pt-16 lg:pb-28 prose prose-natural dark:prose-invert"><main><h1 class="text-4xl font-bold mb-2">在 coq-mode 下开启行号显示</h1><div class="text-sm text-gray-500 mb-5">12/4/2023</div><p>行号（Line<!-- --> <!-- -->Number）的显示，似乎不应该成为一个问题。vscode<!-- --> <!-- -->仓库里还有一个<!-- --> <a href="https://github.com/Microsoft/vscode/issues/52735">issue</a> <!-- -->在询问怎么方便地关闭行号显示。而对于<!-- --> <!-- -->Vim<!-- --> <!-- -->用户来说，一句<!-- --> <code>set :number</code> <!-- -->就可以开启行号显示。</p><p>没错，Emacs<!-- --> <!-- -->就是这么特别的编辑器。对我这样偶尔用一用的用户来说，行号显示也确实是一个困扰我的问题。</p><h2 class="text-3xl" id="问题是什么"><a color="secondary" class="pr-3 no-underline hover:underline" href="#问题是什么">#</a>问题是什么</h2><p>我使用的是一个<!-- --> <!-- -->Emacs<!-- --> <!-- -->的发行版，或者说一个比较成熟的配置文件，<a href="https://www.spacemacs.org/">Spacemacs</a>.<!-- --> <!-- -->在<!-- --> <!-- -->Spacemacs<!-- --> <!-- -->的官方文档里，要开启行号显示，似乎只需要在<!-- --> <code>.spacemacs</code> <!-- -->里设置一下变量就可以了：</p><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-elisp" style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">1</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">setq-default</span><span> dotspacemacs-line-numbers </span><span class="token" style="color:hsl(29, 54%, 61%)">t</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></pre><p>这句话的意思就是，把<!-- --> <code>dotspacemacs-line-numbers</code> <!-- -->设置为<!-- --> <code>t</code>.</p><p>同时，为了支持<!-- --> <!-- -->coq<!-- --> <!-- -->语言，我还装载了<!-- --> <code>coq</code> <!-- -->层（layer）.<!-- --> <!-- -->但如果打开一个<!-- --> <!-- -->coq<!-- --> <!-- -->文件，你也许会惊奇地发现，这时<!-- --> <!-- -->coq<!-- --> <!-- -->源代码是没有行号的：</p><figure><div><img src="https://pic.superbed.cc/item/656efcb312f8d922c1008d4a.png"/></div></figure><p>按照正常的直觉，设置为<!-- --> <code>t</code> <!-- -->应该是会在所有情况下显示行号的。那么，为什么没有显示行号呢？</p><h2 class="text-3xl" id="临时解决方案"><a color="secondary" class="pr-3 no-underline hover:underline" href="#临时解决方案">#</a>临时解决方案</h2><p>解决这个问题，其实比搞清楚原因要容易。</p><p>稍加搜索，我发现<!-- --> <code>spc t n</code> <sup><a href="#note-1" id="note-anchor-1">1</a></sup>可以在当前<!-- --> <!-- -->buffer<!-- --> <!-- -->打开行号，这确实可以解决问题。按照<!-- --> <!-- -->Emacs<!-- --> <!-- -->wiki<!-- --> <!-- -->的说法，这个快捷键调用的实际上是<!-- --> <!-- -->Emacs<!-- --> <!-- -->26.1<!-- --> <!-- -->版本后引入的行号命令<!-- --> <code>display-line-numbers-mode</code>.</p><p>Emacs<!-- --> <!-- -->的命令可以通过<!-- --> <code>m-x</code>，或者<!-- --> <code>spc spc</code> <!-- -->执行。实际上，一个命令就是一个<!-- --> <!-- -->Emacs<!-- --> <!-- -->Lisp<!-- --> <!-- -->的函数，参考<!-- --> <!-- -->Programming<!-- --> <!-- -->Elisp<!-- --> <!-- -->的<a href="https://www.gnu.org/software/emacs/manual/html_node/eintr/Interactive-multiply_002dby_002dseven.html">文档</a>，只要一个函数的函数定义里有<!-- --> <code>(interactive)</code>，那么它就可以当成一个命令调用。</p><p>显然，Spacemacs<!-- --> <!-- -->也是通过这个函数进行行号相关设置。虽然不知道因为什么原因，Spacemacs<!-- --> <!-- -->没有给我的<!-- --> <code>.v</code> <!-- -->文件开启行号，但是我们可以自己开启。</p><p><code>coq</code> <!-- -->层实际上使用了<!-- --> <code>coq-mode</code>.<!-- --> <code>coq-mode</code> <!-- -->是一个<!-- --> <!-- -->Emacs<!-- --> <!-- -->的<a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Major-Modes.html">主模式（Major<!-- --> <!-- -->Mode）</a>，它给<!-- --> <!-- -->coq<!-- --> <!-- -->语言提供了支持，并定义了一大堆快捷键。</p><p>Emacs<!-- --> <!-- -->支持一种叫做<!-- --> <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Hooks.html">Hooks</a> <!-- -->的机制，它允许我们在某个模式加载时，执行一系列操作。既然<!-- --> <!-- -->Spacemacs<!-- --> <!-- -->不会给<!-- --> <code>coq-mode</code> <!-- -->开启行号，我们就通过这种机制手动执行<!-- --> <code>display-line-numbers-mode</code>.</p><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-elisp" style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">1</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token defun" style="color:hsl(286, 60%, 67%)">defun</span><span class="token defun"> </span><span class="token defun" style="color:hsl(207, 82%, 66%)">dotspacemacs/user-config</span><span class="token defun"> </span><span class="token defun" style="color:hsl(220, 14%, 71%)">(</span><span class="token defun" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">2</span><span>  </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;Configuration for user code:
</span><span class="token" style="color:hsl(95, 38%, 62%)"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">3</span>This function is called at the very end of Spacemacs startup, after layer
</span><span class="token" style="color:hsl(95, 38%, 62%)"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">4</span>configuration.
</span><span class="token" style="color:hsl(95, 38%, 62%)"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">5</span>Put your configuration code here, except for variables that should be set
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">6</span><span class="token" style="color:hsl(95, 38%, 62%)">before packages are loaded.&quot;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">7</span><span>  </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">add-hook</span><span> </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">&#x27;coq-mode-hook</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token lambda" style="color:hsl(286, 60%, 67%)">lambda</span><span class="token lambda"> </span><span class="token lambda" style="color:hsl(220, 14%, 71%)">(</span><span class="token lambda" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">display-line-numbers-mode</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">1</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">8</span><span></span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></pre><p>这里的<!-- --> <code>dotspacemacs/user-config</code> <!-- -->是<!-- --> <!-- -->Spacemacs<!-- --> <!-- -->配置文件的一部分，在这里可以执行一些自定义操作。</p><p>这当然就解决了问题。其实，Spacemacs<!-- --> <!-- -->在文档里还提到了一个选项<!-- --> <code>:enabled-for-modes</code>.<!-- --> <!-- -->在这个选项里加上<!-- --> <code>coq-mode</code> <!-- -->可以直接解决问题。不过我直到搞清楚了问题的来源，才发现了有这个选项。</p><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-elisp" style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">1</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">setq-default</span><span> dotspacemacs-line-numbers
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">2</span><span>  </span><span class="token" style="color:hsl(220, 14%, 71%)">&#x27;(</span><span class="token lisp-property" style="color:hsl(355, 65%, 65%)">:enabled-for-modes</span><span> coq-mode</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></pre><h2 class="text-3xl" id="为什么"><a color="secondary" class="pr-3 no-underline hover:underline" href="#为什么">#</a>为什么</h2><p>我首先注意到的是<!-- --> <code>dotspacemacs-line-numbers</code> <!-- -->的注释：</p><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-elisp" style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">1</span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; Control line numbers activation.</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">2</span><span></span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; If set to `t&#x27;, `relative&#x27; or `visual&#x27; then line numbers are enabled in all</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">3</span><span></span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; `prog-mode&#x27; and `text-mode&#x27; derivatives. If set to `relative&#x27;, line</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">4</span><span></span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; numbers are relative. If set to `visual&#x27;, line numbers are also relative,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">5</span><span></span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; but only visual lines are counted. For example, folded lines will not be</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">6</span><span></span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; counted and wrapped lines are counted as multiple lines.</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">7</span><span></span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; This variable can also be set to a property list for finer control:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">8</span><span></span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; (default nil)</span></code></pre><p>这段注释里提到，如果把这个变量设置为<!-- --> <code>t</code>，那么它会默认在<!-- --> <code>prog-mode</code> <!-- -->和<!-- --> <code>text-mode</code> <!-- -->里开启行号。这两个<!-- --> <!-- -->mode<!-- --> <!-- -->被称为<!-- --> <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Basic-Major-Modes.html">Basic<!-- --> <!-- -->Major<!-- --> <!-- -->Mode</a>.<!-- --> <!-- -->一个很自然的猜想是,<!-- --> <code>coq-mode</code> <!-- -->不是它们之一。</p><p>打开一个<!-- --> <!-- -->coq<!-- --> <!-- -->文件，执行<!-- --> <code>m-x describe-mode</code>，会看到：</p><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">1</span><span>Coq mode defined in ‘coq-mode.el’:
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">2</span>Major mode for Coq scripts.</code></pre><p>进入<!-- --> <code>coq-mode.el</code> <!-- -->的源代码查看一下，玄机就在第<!-- --> <!-- -->182<!-- --> <!-- -->行：</p><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-elisp" style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">1</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token defun" style="color:hsl(286, 60%, 67%)">defun</span><span class="token defun"> </span><span class="token defun" style="color:hsl(207, 82%, 66%)">coq--parent-mode</span><span class="token defun"> </span><span class="token defun" style="color:hsl(220, 14%, 71%)">(</span><span class="token defun" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">2</span><span>  </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> coq-use-pg </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">proof-mode</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">prog-mode</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">3</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">4</span><span></span><span class="token heading" style="color:hsl(220, 10%, 40%);font-style:italic">;;;###autoload</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">5</span><span></span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">define-derived-mode</span><span> coq-mode coq--parent-mode </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;Coq&quot;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">6</span>  &quot;Major mode for Coq scripts.</code></pre><p>这个<!-- --> <code>coq--parent-mode</code> <!-- -->显然就是<!-- --> <code>coq-mode</code> <!-- -->的父模式（parent<!-- --> <!-- -->mode），Emasc<!-- --> <!-- -->的模式也有一个继承树，一个模式继承另一个父模式，这棵树的根不确定，有几种情况：</p><ul><li>自己</li><li>Fundamental<!-- --> <!-- -->Mode</li><li>Basic<!-- --> <!-- -->Major<!-- --> <!-- -->Mode</li></ul><p><code>coq-use-pg</code> <!-- -->的值在我的环境里为<!-- --> <code>t</code>，它的父模式是<!-- --> <code>proof-mode</code>.<!-- --> <code>proof-mode</code> <!-- -->的父模式又是什么呢？</p><p>StackOverflow<!-- --> <!-- -->的<a href="https://emacs.stackexchange.com/questions/58073/how-to-find-inheritance-of-modes">一个问题</a>提供了相关代码：</p><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-elisp" style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">1</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token defun" style="color:hsl(286, 60%, 67%)">defun</span><span class="token defun"> </span><span class="token defun" style="color:hsl(207, 82%, 66%)">derived-modes</span><span class="token defun"> </span><span class="token defun" style="color:hsl(220, 14%, 71%)">(</span><span class="token defun arguments argument" style="color:hsl(207, 82%, 66%)">mode</span><span class="token defun" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">2</span><span>  </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;Return a list of the ancestor modes that </span><span class="token argument" style="color:hsl(95, 38%, 62%)">MODE</span><span class="token" style="color:hsl(95, 38%, 62%)"> is derived from.&quot;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">3</span><span>  </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">let</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">modes</span><span>   </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">4</span><span>        </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">parent</span><span>  </span><span class="token" style="color:hsl(29, 54%, 61%)">nil</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">5</span><span>    </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">while</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">setq</span><span> parent </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">get</span><span> mode </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">&#x27;derived-mode-parent</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">6</span><span>      </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">push</span><span> parent modes</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">7</span><span>      </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">setq</span><span> mode parent</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">8</span><span>    </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">setq</span><span> modes  </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">nreverse</span><span> modes</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></pre><p>用这个函数，确实可以得到一些“正常”模式的继承路径，比如我们刚刚说的<!-- --> <code>proof-mode</code>:</p><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-elisp" style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">1</span><span>ELISP&gt; </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">derived-modes</span><span> </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">&#x27;proof-mode</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">2</span><span></span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">prog-mode</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></pre><p>是的，<code>proof-mode</code> <!-- -->的父模式就是<!-- --> <code>prog-mode</code>.<!-- --> <!-- -->如果你还记得刚才的文档的话，<code>prog-mode</code> <!-- -->在<!-- --> <code>dotspacemacs-line-numbers</code> <!-- -->设置为<!-- --> <code>t</code> <!-- -->的时候也应该显示行号。</p><p>那么，究竟是什么地方错了呢？不妨给这个函数输入<!-- --> <code>&#x27;coq-mode</code>:</p><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-elisp" style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">1</span><span>ELISP&gt; </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">derived-modes</span><span> </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">&#x27;coq-mode</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">2</span><span></span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">coq--parent-mode</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></pre><p>它的输出是<!-- --> <code>(coq--parent-mode)</code>，这只是父模式的符号，而不是求值后的父模式。可见，<code>(get &#x27;coq-mode &#x27;derived-parent-mode)</code> <!-- -->这个表达式只能拿到语法上的符号，而非它真正的父模式。检查<!-- --> <code>define-derived-mode</code> <!-- -->的源代码，可以发现<!-- --> <code>(get mode &#x27;derived-mode-parent)</code> <!-- -->拿到的是这句话设置的父模式：</p><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-elisp" style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">1</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">put</span><span> &#x27;</span><span class="token splice" style="color:hsl(207, 82%, 66%)">,child</span><span> </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">&#x27;derived-mode-parent</span><span> &#x27;</span><span class="token splice" style="color:hsl(207, 82%, 66%)">,parent</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></pre><p>那么，Spacemacs<!-- --> <!-- -->是这样得到父模式的吗？Spacemacs<!-- --> <!-- -->在<!-- --> <code>spacemacs/layers/+spacemacs/spacemacs-defaults/funcs.el</code> <!-- -->的<!-- --> <code>spacemacs//linum-enabled-for-current-major-mode</code> <!-- -->函数中检查是否在当前模式下开启行号显示：</p><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-elisp" style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">1</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token defun" style="color:hsl(286, 60%, 67%)">defun</span><span class="token defun"> </span><span class="token defun" style="color:hsl(207, 82%, 66%)">spacemacs//linum-enabled-for-current-major-mode</span><span class="token defun"> </span><span class="token defun" style="color:hsl(220, 14%, 71%)">(</span><span class="token defun" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">2</span><span>  </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;Return non-nil if line number is enabled for current major-mode.&quot;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">3</span><span>  </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">let*</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">disabled-for-modes</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">4</span><span>          </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">spacemacs/mplist-get-values</span><span> dotspacemacs-line-numbers
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">5</span><span>                                       </span><span class="token lisp-property" style="color:hsl(355, 65%, 65%)">:disabled-for-modes</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">6</span><span>         </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">user-enabled-for-modes</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">7</span><span>          </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">spacemacs/mplist-get-values</span><span> dotspacemacs-line-numbers
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">8</span><span>                                       </span><span class="token lisp-property" style="color:hsl(355, 65%, 65%)">:enabled-for-modes</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">9</span><span>         </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; default `enabled-for-modes&#x27; to &#x27;(prog-mode text-mode), because it is</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">10</span><span>         </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; a more sensible default than enabling in all buffers - including</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">11</span><span>         </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; Magit buffers, terminal buffers, etc. But don&#x27;t include prog-mode or</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">12</span><span>         </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; text-mode if they&#x27;re explicitly disabled by user</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">13</span><span>         </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">enabled-for-modes</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">or</span><span> user-enabled-for-modes
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">14</span><span>                                </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">seq-difference</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">&#x27;(</span><span class="token car">prog-mode</span><span> text-mode</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">15</span>                                                disabled-for-modes
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">16</span><span>                                                </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">#&#x27;eq</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">17</span><span>         </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">enabled-for-parent</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">or</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">and</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">equal</span><span> enabled-for-modes </span><span class="token" style="color:hsl(220, 14%, 71%)">&#x27;(</span><span class="token car">all</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">&#x27;all</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">18</span><span>                                 </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">apply</span><span> </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">#&#x27;derived-mode-p</span><span> enabled-for-modes</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">19</span><span>         </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">disabled-for-parent</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">apply</span><span> </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">#&#x27;derived-mode-p</span><span> disabled-for-modes</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">20</span><span>    </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">or</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">21</span><span>     </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; special case &#x27;all: enable for any mode that isn&#x27;t specifically disabled</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">22</span><span>     </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">and</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">eq</span><span> enabled-for-parent </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">&#x27;all</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">not</span><span> disabled-for-parent</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">23</span><span>     </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; current mode or a parent is in :enabled-for-modes, and there isn&#x27;t a</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">24</span><span>     </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; more specific parent (or the mode itself) in :disabled-for-modes</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">25</span><span>     </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">and</span><span> enabled-for-parent
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">26</span><span>          </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">or</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">not</span><span> disabled-for-parent</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">27</span><span>              </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; handles the case where current major-mode has a parent both in</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">28</span><span>              </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; :enabled-for-modes and in :disabled-for-modes. Return non-nil</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">29</span><span>              </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; if enabled-for-parent is the more specific parent (IOW derives</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">30</span><span>              </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; from disabled-for-parent)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">31</span><span>              </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">spacemacs/derived-mode-p</span><span> enabled-for-parent disabled-for-parent</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">32</span><span>     </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">;; current mode (or parent) not explicitly disabled</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">33</span><span>     </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">and</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">null</span><span> user-enabled-for-modes</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">34</span><span>          enabled-for-parent            </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic">; mode is one of default allowed modes</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">35</span>          disabled-for-modes
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">36</span><span>          </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">not</span><span> disabled-for-parent</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></pre><p>可以看到，它通过<!-- --> <code>derived-mode-p</code> <!-- -->函数询问当前<!-- --> <!-- -->buffer<!-- --> <!-- -->的<!-- --> <!-- -->major<!-- --> <!-- -->mode<!-- --> <!-- -->是不是预设的<!-- --> <code>enabled-for-modes</code> <!-- -->的子模式。<code>dervied-mode-p</code> <!-- -->是<!-- --> <!-- -->Emacs<!-- --> <!-- -->提供的一个函数，<a href="https://doc.endlessparentheses.com/Fun/derived-mode-p.html">文档</a>声称，如果当前<!-- --> <!-- -->buffer<!-- --> <!-- -->的主模式是<!-- --> <code>modes</code> <!-- -->的子模式，那么<!-- --> <code>(derived-mode-p modes)</code> <!-- -->将返回非<!-- --> <code>nil</code> <!-- -->值。</p><p>再检查<!-- --> <code>derived-mode-p</code> <!-- -->的源代码，我们终于发现了问题的根源。</p><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-elisp" style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">1</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token defun" style="color:hsl(286, 60%, 67%)">defun</span><span class="token defun"> </span><span class="token defun" style="color:hsl(207, 82%, 66%)">provided-mode-derived-p</span><span class="token defun"> </span><span class="token defun" style="color:hsl(220, 14%, 71%)">(</span><span class="token defun arguments argument" style="color:hsl(207, 82%, 66%)">mode</span><span class="token defun arguments"> </span><span class="token defun arguments rest-vars lisp-marker">&amp;rest</span><span class="token defun arguments rest-vars"> </span><span class="token defun arguments rest-vars argument">modes</span><span class="token defun" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">2</span><span>  </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;Non-nil if </span><span class="token argument" style="color:hsl(95, 38%, 62%)">MODE</span><span class="token" style="color:hsl(95, 38%, 62%)"> is derived from one of </span><span class="token argument" style="color:hsl(95, 38%, 62%)">MODES</span><span class="token" style="color:hsl(95, 38%, 62%)"> or their aliases.
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">3</span><span class="token" style="color:hsl(95, 38%, 62%)">Uses the </span><span class="token" style="color:hsl(355, 65%, 65%)">`derived-mode-parent&#x27;</span><span class="token" style="color:hsl(95, 38%, 62%)"> property of the symbol to trace backwards.
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">4</span><span class="token" style="color:hsl(95, 38%, 62%)">If you just want to check </span><span class="token" style="color:hsl(355, 65%, 65%)">`major-mode&#x27;</span><span class="token" style="color:hsl(95, 38%, 62%)">, use </span><span class="token" style="color:hsl(355, 65%, 65%)">`derived-mode-p&#x27;</span><span class="token" style="color:hsl(95, 38%, 62%)">.&quot;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">5</span><span>  </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">while</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">6</span><span>      </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">and</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">7</span><span>       </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">not</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">memq</span><span> mode modes</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">8</span><span>       </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">let*</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">parent</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">get</span><span> mode </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">&#x27;derived-mode-parent</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">9</span><span>              </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">parentfn</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">symbol-function</span><span> parent</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">10</span><span>         </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">setq</span><span> mode </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">and</span><span> parentfn </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">symbolp</span><span> parentfn</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> parentfn parent</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">11</span><span>  mode</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">12</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">13</span><span></span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token defun" style="color:hsl(286, 60%, 67%)">defun</span><span class="token defun"> </span><span class="token defun" style="color:hsl(207, 82%, 66%)">derived-mode-p</span><span class="token defun"> </span><span class="token defun" style="color:hsl(220, 14%, 71%)">(</span><span class="token defun arguments rest-vars lisp-marker">&amp;rest</span><span class="token defun arguments rest-vars"> </span><span class="token defun arguments rest-vars argument">modes</span><span class="token defun" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">14</span><span>  </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;Non-nil if the current major mode is derived from one of </span><span class="token argument" style="color:hsl(95, 38%, 62%)">MODES</span><span class="token" style="color:hsl(95, 38%, 62%)">.
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">15</span><span class="token" style="color:hsl(95, 38%, 62%)">Uses the </span><span class="token" style="color:hsl(355, 65%, 65%)">`derived-mode-parent&#x27;</span><span class="token" style="color:hsl(95, 38%, 62%)"> property of the symbol to trace backwards.&quot;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">16</span><span>  </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">apply</span><span> </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">#&#x27;provided-mode-derived-p</span><span> major-mode modes</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></pre><p><code>dervied-mode-p</code> <!-- -->同样通过<!-- --> <code>(get mode &#x27;derived-mode-parent)</code> <!-- -->来得到某个模式的父模式，而这对于<!-- --> <code>coq-mode</code> <!-- -->来说会得到<!-- --> <code>coq--parent-mode</code>,<!-- --> <!-- -->继承链在这里就断了。</p><p>Emacs<!-- --> <!-- -->中的模式定义最后确实是定义了一个函数。然而，如果<!-- --> <code>&#x27;parent</code> <!-- -->不能求值出正确的父模式，Emacs<!-- --> <!-- -->对于<!-- --> <!-- -->mode<!-- --> <!-- -->的预设函数就会得不到期望的结果。显然，<code>coq-mode</code> <!-- -->不应该这样定义<!-- --> <code>coq--parent-mode</code>.<!-- --> <!-- -->那么，到底应该怎么定义<!-- --> <code>coq--parent-mode</code> <!-- -->呢？</p><h2 class="text-3xl" id="最终解决方案"><a color="secondary" class="pr-3 no-underline hover:underline" href="#最终解决方案">#</a>最终解决方案</h2><p>Emacs<!-- --> <!-- -->Lisp<!-- --> <!-- -->的全局变量和全局函数是不同的，这和<!-- --> <!-- -->Scheme<!-- --> <!-- -->很不一样。如果直接把<!-- --> <code>coq--parent-mode</code> <!-- -->定义为一个变量，会使得<!-- --> <code>coq-mode</code> <!-- -->无法加载。</p><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-elisp" style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">1</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token defvar" style="color:hsl(286, 60%, 67%)">defvar</span><span class="token defvar"> </span><span class="token defvar" style="color:hsl(207, 82%, 66%)">coq--parent-mode</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">2</span><span>  </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> coq-use-pg </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">&#x27;proof-mode</span><span> </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">&#x27;prog-mode</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></pre><p>万幸的是，Emacs<!-- --> <!-- -->Lisp<!-- --> <!-- -->提供了一个叫做<!-- --> <code>defalias</code> <!-- -->的函数，它可以把<!-- --> <code>coq--parent-mode</code> <!-- -->定义为一个<!-- --> <!-- -->alias.</p><pre style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-elisp" style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">1</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token car">defalias</span><span> </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">&#x27;coq--parent-mode</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:hsl(220, 10%, 40%);font-style:italic">2</span><span>  </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> coq-use-pg </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">&#x27;proof-mode</span><span> </span><span class="token quoted-symbol" style="color:hsl(355, 65%, 65%)">&#x27;prog-mode</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></pre><p>上面的修改就足以使得<!-- --> <!-- -->Spacemacs<!-- --> <!-- -->可以自动侦测到<!-- --> <code>coq-mode</code> <!-- -->派生自<!-- --> <code>prog-mode</code>，从而开启行号显示。我已经提交了一个<!-- --> <a href="https://github.com/ProofGeneral/PG/pull/717">PR</a>，并合入了主分支。</p><div class="notes"></div></main></div></div><script src="/_next/static/chunks/webpack-4e8d71c3f65c460f.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/2f71e0d51b6954c9.css\",\"style\"]\n3:HL[\"/_next/static/css/cb36c8a6d34b9690.css\",\"style\"]\n4:HL[\"/_next/static/css/ad2762ca96cee671.css\",\"style\"]\n5:HL[\"/_next/static/css/ecc949282143a457.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"6:I[89562,[],\"\"]\n8:\"$Sreact.fragment\"\n9:I[65469,[\"945\",\"static/chunks/945-45c92e2d248fab37.js\",\"786\",\"static/chunks/786-c6fa5cb99b8c7140.js\",\"807\",\"static/chunks/807-c8470476b2b24d30.js\",\"827\",\"static/chunks/app/%5Blocale%5D/posts/%5Bslug%5D/page-cadedd2465269073.js\"],\"\"]\na:I[39926,[\"945\",\"static/chunks/945-45c92e2d248fab37.js\",\"786\",\"static/chunks/786-c6fa5cb99b8c7140.js\",\"807\",\"static/chunks/807-c8470476b2b24d30.js\",\"827\",\"static/chunks/app/%5Blocale%5D/posts/%5Bslug%5D/page-cadedd2465269073.js\"],\"default\"]\nc:I[27377,[\"945\",\"static/chunks/945-45c92e2d248fab37.js\",\"786\",\"static/chunks/786-c6fa5cb99b8c7140.js\",\"807\",\"static/chunks/807-c8470476b2b24d30.js\",\"827\",\"static/chunks/app/%5Blocale%5D/posts/%5Bslug%5D/page-cadedd2465269073.js\"],\"default\"]\nd:I[78703,[],\"\"]\n10:I[53751,[],\"\"]\n11:I[59576,[\"945\",\"static/chunks/945-45c92e2d248fab37.js\",\"327\",\"static/chunks/327-1450e5f44eb18d82.js\",\"786\",\"static/chunks/786-c6fa5cb99b8c7140.js\",\"256\",\"static/chunks/256-7bc8f523a9d252a9.js\",\"203\",\"static/chunks/app/%5Blocale%5D/layout-54c8e01b9c8af01a.js\"],\"Providers\"]\n14:I[51395,[],\"\"]\nb:T899,"])</script><script>self.__next_f.push([1,"(defun spacemacs//linum-enabled-for-current-major-mode ()\n  \"Return non-nil if line number is enabled for current major-mode.\"\n  (let* ((disabled-for-modes\n          (spacemacs/mplist-get-values dotspacemacs-line-numbers\n                                       :disabled-for-modes))\n         (user-enabled-for-modes\n          (spacemacs/mplist-get-values dotspacemacs-line-numbers\n                                       :enabled-for-modes))\n         ;; default `enabled-for-modes' to '(prog-mode text-mode), because it is\n         ;; a more sensible default than enabling in all buffers - including\n         ;; Magit buffers, terminal buffers, etc. But don't include prog-mode or\n         ;; text-mode if they're explicitly disabled by user\n         (enabled-for-modes (or user-enabled-for-modes\n                                (seq-difference '(prog-mode text-mode)\n                                                disabled-for-modes\n                                                #'eq)))\n         (enabled-for-parent (or (and (equal enabled-for-modes '(all)) 'all)\n                                 (apply #'derived-mode-p enabled-for-modes)))\n         (disabled-for-parent (apply #'derived-mode-p disabled-for-modes)))\n    (or\n     ;; special case 'all: enable for any mode that isn't specifically disabled\n     (and (eq enabled-for-parent 'all) (not disabled-for-parent))\n     ;; current mode or a parent is in :enabled-for-modes, and there isn't a\n     ;; more specific parent (or the mode itself) in :disabled-for-modes\n     (and enabled-for-parent\n          (or (not disabled-for-parent)\n              ;; handles the case where current major-mode has a parent both in\n              ;; :enabled-for-modes and in :disabled-for-modes. Return non-nil\n              ;; if enabled-for-parent is the more specific parent (IOW derives\n              ;; from disabled-for-parent)\n              (spacemacs/derived-mode-p enabled-for-parent disabled-for-parent)))\n     ;; current mode (or parent) not explicitly disabled\n     (and (null user-enabled-for-modes)\n          enabled-for-parent            ; mode is one of default allowed modes\n          disabled-for-modes\n          (not disabled-for-parent)))))"])</script><script>self.__next_f.push([1,"e:[\"locale\",\"zh-cn\",\"d\"]\nf:[\"slug\",\"emacs-line-number\",\"d\"]\n15:[]\n"])</script><script>self.__next_f.push([1,"0:[null,[\"$\",\"$L6\",null,{\"buildId\":\"nlocMstpEuBY6g5FYGcBu\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/zh-cn/posts/emacs-line-number\",\"initialTree\":[\"\",{\"children\":[[\"locale\",\"zh-cn\",\"d\"],{\"children\":[\"posts\",{\"children\":[[\"slug\",\"emacs-line-number\",\"d\"],{\"children\":[\"__PAGE__?{\\\"locale\\\":\\\"zh-cn\\\",\\\"slug\\\":\\\"emacs-line-number\\\"}\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"locale\",\"zh-cn\",\"d\"],{\"children\":[\"posts\",{\"children\":[[\"slug\",\"emacs-line-number\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L7\",[\"$\",\"main\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-4xl font-bold mb-2\",\"children\":\"在 coq-mode 下开启行号显示\"}],[\"$\",\"div\",null,{\"className\":\"text-sm text-gray-500 mb-5\",\"children\":\"12/4/2023\"}],[\"$\",\"$8\",\"0\",{\"children\":[[\"$\",\"p\",null,{\"children\":[\"行号（Line\",\" \",\"Number）的显示，似乎不应该成为一个问题。vscode\",\" \",\"仓库里还有一个\",\" \",[\"$\",\"a\",\"0\",{\"href\":\"https://github.com/Microsoft/vscode/issues/52735\",\"children\":[\"issue\"]}],\" \",\"在询问怎么方便地关闭行号显示。而对于\",\" \",\"Vim\",\" \",\"用户来说，一句\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"set :number\"]}],\" \",\"就可以开启行号显示。\"]}],[\"$\",\"p\",null,{\"children\":[\"没错，Emacs\",\" \",\"就是这么特别的编辑器。对我这样偶尔用一用的用户来说，行号显示也确实是一个困扰我的问题。\"]}],[\"$\",\"h2\",null,{\"className\":\"text-3xl\",\"id\":\"问题是什么\",\"children\":[[\"$\",\"$L9\",null,{\"href\":\"#问题是什么\",\"color\":\"secondary\",\"className\":\"pr-3 no-underline hover:underline\",\"children\":\"#\"}],[\"问题是什么\"]]}],[\"$\",\"p\",null,{\"children\":[\"我使用的是一个\",\" \",\"Emacs\",\" \",\"的发行版，或者说一个比较成熟的配置文件，\",[\"$\",\"a\",\"0\",{\"href\":\"https://www.spacemacs.org/\",\"children\":[\"Spacemacs\"]}],\".\",\" \",\"在\",\" \",\"Spacemacs\",\" \",\"的官方文档里，要开启行号显示，似乎只需要在\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\".spacemacs\"]}],\" \",\"里设置一下变量就可以了：\"]}],[\"$\",\"$La\",\"4\",{\"className\":\"elisp\",\"children\":[\"(setq-default dotspacemacs-line-numbers t)\"]}],[\"$\",\"p\",null,{\"children\":[\"这句话的意思就是，把\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"dotspacemacs-line-numbers\"]}],\" \",\"设置为\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"t\"]}],\".\"]}],[\"$\",\"p\",null,{\"children\":[\"同时，为了支持\",\" \",\"coq\",\" \",\"语言，我还装载了\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"coq\"]}],\" \",\"层（layer）.\",\" \",\"但如果打开一个\",\" \",\"coq\",\" \",\"文件，你也许会惊奇地发现，这时\",\" \",\"coq\",\" \",\"源代码是没有行号的：\"]}],[\"$\",\"figure\",\"7\",{\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"img\",\"0\",{\"src\":\"https://pic.superbed.cc/item/656efcb312f8d922c1008d4a.png\"}]]}]]}],[\"$\",\"p\",null,{\"children\":[\"按照正常的直觉，设置为\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"t\"]}],\" \",\"应该是会在所有情况下显示行号的。那么，为什么没有显示行号呢？\"]}],[\"$\",\"h2\",null,{\"className\":\"text-3xl\",\"id\":\"临时解决方案\",\"children\":[[\"$\",\"$L9\",null,{\"href\":\"#临时解决方案\",\"color\":\"secondary\",\"className\":\"pr-3 no-underline hover:underline\",\"children\":\"#\"}],[\"临时解决方案\"]]}],[\"$\",\"p\",null,{\"children\":[\"解决这个问题，其实比搞清楚原因要容易。\"]}],[\"$\",\"p\",null,{\"children\":[\"稍加搜索，我发现\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"spc t n\"]}],\" \",[\"$\",\"sup\",\"1\",{\"children\":[[\"$\",\"a\",\"0\",{\"href\":\"#note-1\",\"id\":\"note-anchor-1\",\"children\":[\"1\"]}]]}],\"可以在当前\",\" \",\"buffer\",\" \",\"打开行号，这确实可以解决问题。按照\",\" \",\"Emacs\",\" \",\"wiki\",\" \",\"的说法，这个快捷键调用的实际上是\",\" \",\"Emacs\",\" \",\"26.1\",\" \",\"版本后引入的行号命令\",\" \",[\"$\",\"code\",\"2\",{\"children\":[\"display-line-numbers-mode\"]}],\".\"]}],[\"$\",\"p\",null,{\"children\":[\"Emacs\",\" \",\"的命令可以通过\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"m-x\"]}],\"，或者\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"spc spc\"]}],\" \",\"执行。实际上，一个命令就是一个\",\" \",\"Emacs\",\" \",\"Lisp\",\" \",\"的函数，参考\",\" \",\"Programming\",\" \",\"Elisp\",\" \",\"的\",[\"$\",\"a\",\"2\",{\"href\":\"https://www.gnu.org/software/emacs/manual/html_node/eintr/Interactive-multiply_002dby_002dseven.html\",\"children\":[\"文档\"]}],\"，只要一个函数的函数定义里有\",\" \",[\"$\",\"code\",\"3\",{\"children\":[\"(interactive)\"]}],\"，那么它就可以当成一个命令调用。\"]}],[\"$\",\"p\",null,{\"children\":[\"显然，Spacemacs\",\" \",\"也是通过这个函数进行行号相关设置。虽然不知道因为什么原因，Spacemacs\",\" \",\"没有给我的\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\".v\"]}],\" \",\"文件开启行号，但是我们可以自己开启。\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",\"0\",{\"children\":[\"coq\"]}],\" \",\"层实际上使用了\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"coq-mode\"]}],\".\",\" \",[\"$\",\"code\",\"2\",{\"children\":[\"coq-mode\"]}],\" \",\"是一个\",\" \",\"Emacs\",\" \",\"的\",[\"$\",\"a\",\"3\",{\"href\":\"https://www.gnu.org/software/emacs/manual/html_node/emacs/Major-Modes.html\",\"children\":[\"主模式（Major\",\" \",\"Mode）\"]}],\"，它给\",\" \",\"coq\",\" \",\"语言提供了支持，并定义了一大堆快捷键。\"]}],[\"$\",\"p\",null,{\"children\":[\"Emacs\",\" \",\"支持一种叫做\",\" \",[\"$\",\"a\",\"0\",{\"href\":\"https://www.gnu.org/software/emacs/manual/html_node/emacs/Hooks.html\",\"children\":[\"Hooks\"]}],\" \",\"的机制，它允许我们在某个模式加载时，执行一系列操作。既然\",\" \",\"Spacemacs\",\" \",\"不会给\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"coq-mode\"]}],\" \",\"开启行号，我们就通过这种机制手动执行\",\" \",[\"$\",\"code\",\"2\",{\"children\":[\"display-line-numbers-mode\"]}],\".\"]}],[\"$\",\"$La\",\"16\",{\"className\":\"elisp\",\"children\":[\"(defun dotspacemacs/user-config ()\\n  \\\"Configuration for user code:\\nThis function is called at the very end of Spacemacs startup, after layer\\nconfiguration.\\nPut your configuration code here, except for variables that should be set\\nbefore packages are loaded.\\\"\\n  (add-hook 'coq-mode-hook (lambda () (display-line-numbers-mode 1)))\\n)\"]}],[\"$\",\"p\",null,{\"children\":[\"这里的\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"dotspacemacs/user-config\"]}],\" \",\"是\",\" \",\"Spacemacs\",\" \",\"配置文件的一部分，在这里可以执行一些自定义操作。\"]}],[\"$\",\"p\",null,{\"children\":[\"这当然就解决了问题。其实，Spacemacs\",\" \",\"在文档里还提到了一个选项\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\":enabled-for-modes\"]}],\".\",\" \",\"在这个选项里加上\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"coq-mode\"]}],\" \",\"可以直接解决问题。不过我直到搞清楚了问题的来源，才发现了有这个选项。\"]}],[\"$\",\"$La\",\"19\",{\"className\":\"elisp\",\"children\":[\"(setq-default dotspacemacs-line-numbers\\n  '(:enabled-for-modes coq-mode))\"]}],[\"$\",\"h2\",null,{\"className\":\"text-3xl\",\"id\":\"为什么\",\"children\":[[\"$\",\"$L9\",null,{\"href\":\"#为什么\",\"color\":\"secondary\",\"className\":\"pr-3 no-underline hover:underline\",\"children\":\"#\"}],[\"为什么\"]]}],[\"$\",\"p\",null,{\"children\":[\"我首先注意到的是\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"dotspacemacs-line-numbers\"]}],\" \",\"的注释：\"]}],[\"$\",\"$La\",\"22\",{\"className\":\"elisp\",\"children\":[\";; Control line numbers activation.\\n;; If set to `t', `relative' or `visual' then line numbers are enabled in all\\n;; `prog-mode' and `text-mode' derivatives. If set to `relative', line\\n;; numbers are relative. If set to `visual', line numbers are also relative,\\n;; but only visual lines are counted. For example, folded lines will not be\\n;; counted and wrapped lines are counted as multiple lines.\\n;; This variable can also be set to a property list for finer control:\\n;; (default nil)\"]}],[\"$\",\"p\",null,{\"children\":[\"这段注释里提到，如果把这个变量设置为\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"t\"]}],\"，那么它会默认在\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"prog-mode\"]}],\" \",\"和\",\" \",[\"$\",\"code\",\"2\",{\"children\":[\"text-mode\"]}],\" \",\"里开启行号。这两个\",\" \",\"mode\",\" \",\"被称为\",\" \",[\"$\",\"a\",\"3\",{\"href\":\"https://www.gnu.org/software/emacs/manual/html_node/elisp/Basic-Major-Modes.html\",\"children\":[\"Basic\",\" \",\"Major\",\" \",\"Mode\"]}],\".\",\" \",\"一个很自然的猜想是,\",\" \",[\"$\",\"code\",\"4\",{\"children\":[\"coq-mode\"]}],\" \",\"不是它们之一。\"]}],[\"$\",\"p\",null,{\"children\":[\"打开一个\",\" \",\"coq\",\" \",\"文件，执行\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"m-x describe-mode\"]}],\"，会看到：\"]}],[\"$\",\"$La\",\"25\",{\"children\":[\"Coq mode defined in ‘coq-mode.el’:\\nMajor mode for Coq scripts.\"]}],[\"$\",\"p\",null,{\"children\":[\"进入\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"coq-mode.el\"]}],\" \",\"的源代码查看一下，玄机就在第\",\" \",\"182\",\" \",\"行：\"]}],[\"$\",\"$La\",\"27\",{\"className\":\"elisp\",\"children\":[\"(defun coq--parent-mode ()\\n  (if coq-use-pg (proof-mode) (prog-mode)))\\n\\n;;;###autoload\\n(define-derived-mode coq-mode coq--parent-mode \\\"Coq\\\"\\n  \\\"Major mode for Coq scripts.\"]}],[\"$\",\"p\",null,{\"children\":[\"这个\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"coq--parent-mode\"]}],\" \",\"显然就是\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"coq-mode\"]}],\" \",\"的父模式（parent\",\" \",\"mode），Emasc\",\" \",\"的模式也有一个继承树，一个模式继承另一个父模式，这棵树的根不确定，有几种情况：\"]}],[\"$\",\"ul\",\"29\",{\"children\":[[\"$\",\"li\",\"0\",{\"children\":[\"自己\"]}],[\"$\",\"li\",\"1\",{\"children\":[\"Fundamental\",\" \",\"Mode\"]}],[\"$\",\"li\",\"2\",{\"children\":[\"Basic\",\" \",\"Major\",\" \",\"Mode\"]}]]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",\"0\",{\"children\":[\"coq-use-pg\"]}],\" \",\"的值在我的环境里为\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"t\"]}],\"，它的父模式是\",\" \",[\"$\",\"code\",\"2\",{\"children\":[\"proof-mode\"]}],\".\",\" \",[\"$\",\"code\",\"3\",{\"children\":[\"proof-mode\"]}],\" \",\"的父模式又是什么呢？\"]}],[\"$\",\"p\",null,{\"children\":[\"StackOverflow\",\" \",\"的\",[\"$\",\"a\",\"0\",{\"href\":\"https://emacs.stackexchange.com/questions/58073/how-to-find-inheritance-of-modes\",\"children\":[\"一个问题\"]}],\"提供了相关代码：\"]}],[\"$\",\"$La\",\"32\",{\"className\":\"elisp\",\"children\":[\"(defun derived-modes (mode)\\n  \\\"Return a list of the ancestor modes that MODE is derived from.\\\"\\n  (let ((modes   ())\\n        (parent  nil))\\n    (while (setq parent (get mode 'derived-mode-parent))\\n      (push parent modes)\\n      (setq mode parent))\\n    (setq modes  (nreverse modes))))\"]}],[\"$\",\"p\",null,{\"children\":[\"用这个函数，确实可以得到一些“正常”模式的继承路径，比如我们刚刚说的\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"proof-mode\"]}],\":\"]}],[\"$\",\"$La\",\"34\",{\"className\":\"elisp\",\"children\":[\"ELISP\u003e (derived-modes 'proof-mode)\\n(prog-mode)\"]}],[\"$\",\"p\",null,{\"children\":[\"是的，\",[\"$\",\"code\",\"0\",{\"children\":[\"proof-mode\"]}],\" \",\"的父模式就是\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"prog-mode\"]}],\".\",\" \",\"如果你还记得刚才的文档的话，\",[\"$\",\"code\",\"2\",{\"children\":[\"prog-mode\"]}],\" \",\"在\",\" \",[\"$\",\"code\",\"3\",{\"children\":[\"dotspacemacs-line-numbers\"]}],\" \",\"设置为\",\" \",[\"$\",\"code\",\"4\",{\"children\":[\"t\"]}],\" \",\"的时候也应该显示行号。\"]}],[\"$\",\"p\",null,{\"children\":[\"那么，究竟是什么地方错了呢？不妨给这个函数输入\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"'coq-mode\"]}],\":\"]}],[\"$\",\"$La\",\"37\",{\"className\":\"elisp\",\"children\":[\"ELISP\u003e (derived-modes 'coq-mode)\\n(coq--parent-mode)\"]}],[\"$\",\"p\",null,{\"children\":[\"它的输出是\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"(coq--parent-mode)\"]}],\"，这只是父模式的符号，而不是求值后的父模式。可见，\",[\"$\",\"code\",\"1\",{\"children\":[\"(get 'coq-mode 'derived-parent-mode)\"]}],\" \",\"这个表达式只能拿到语法上的符号，而非它真正的父模式。检查\",\" \",[\"$\",\"code\",\"2\",{\"children\":[\"define-derived-mode\"]}],\" \",\"的源代码，可以发现\",\" \",[\"$\",\"code\",\"3\",{\"children\":[\"(get mode 'derived-mode-parent)\"]}],\" \",\"拿到的是这句话设置的父模式：\"]}],[\"$\",\"$La\",\"39\",{\"className\":\"elisp\",\"children\":[\"(put ',child 'derived-mode-parent ',parent)\"]}],[\"$\",\"p\",null,{\"children\":[\"那么，Spacemacs\",\" \",\"是这样得到父模式的吗？Spacemacs\",\" \",\"在\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"spacemacs/layers/+spacemacs/spacemacs-defaults/funcs.el\"]}],\" \",\"的\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"spacemacs//linum-enabled-for-current-major-mode\"]}],\" \",\"函数中检查是否在当前模式下开启行号显示：\"]}],[\"$\",\"$La\",\"41\",{\"className\":\"elisp\",\"children\":[\"$b\"]}],[\"$\",\"p\",null,{\"children\":[\"可以看到，它通过\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"derived-mode-p\"]}],\" \",\"函数询问当前\",\" \",\"buffer\",\" \",\"的\",\" \",\"major\",\" \",\"mode\",\" \",\"是不是预设的\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"enabled-for-modes\"]}],\" \",\"的子模式。\",[\"$\",\"code\",\"2\",{\"children\":[\"dervied-mode-p\"]}],\" \",\"是\",\" \",\"Emacs\",\" \",\"提供的一个函数，\",[\"$\",\"a\",\"3\",{\"href\":\"https://doc.endlessparentheses.com/Fun/derived-mode-p.html\",\"children\":[\"文档\"]}],\"声称，如果当前\",\" \",\"buffer\",\" \",\"的主模式是\",\" \",[\"$\",\"code\",\"4\",{\"children\":[\"modes\"]}],\" \",\"的子模式，那么\",\" \",[\"$\",\"code\",\"5\",{\"children\":[\"(derived-mode-p modes)\"]}],\" \",\"将返回非\",\" \",[\"$\",\"code\",\"6\",{\"children\":[\"nil\"]}],\" \",\"值。\"]}],[\"$\",\"p\",null,{\"children\":[\"再检查\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"derived-mode-p\"]}],\" \",\"的源代码，我们终于发现了问题的根源。\"]}],[\"$\",\"$La\",\"44\",{\"className\":\"elisp\",\"children\":[\"(defun provided-mode-derived-p (mode \u0026rest modes)\\n  \\\"Non-nil if MODE is derived from one of MODES or their aliases.\\nUses the `derived-mode-parent' property of the symbol to trace backwards.\\nIf you just want to check `major-mode', use `derived-mode-p'.\\\"\\n  (while\\n      (and\\n       (not (memq mode modes))\\n       (let* ((parent (get mode 'derived-mode-parent))\\n              (parentfn (symbol-function parent)))\\n         (setq mode (if (and parentfn (symbolp parentfn)) parentfn parent)))))\\n  mode)\\n\\n(defun derived-mode-p (\u0026rest modes)\\n  \\\"Non-nil if the current major mode is derived from one of MODES.\\nUses the `derived-mode-parent' property of the symbol to trace backwards.\\\"\\n  (apply #'provided-mode-derived-p major-mode modes))\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",\"0\",{\"children\":[\"dervied-mode-p\"]}],\" \",\"同样通过\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"(get mode 'derived-mode-parent)\"]}],\" \",\"来得到某个模式的父模式，而这对于\",\" \",[\"$\",\"code\",\"2\",{\"children\":[\"coq-mode\"]}],\" \",\"来说会得到\",\" \",[\"$\",\"code\",\"3\",{\"children\":[\"coq--parent-mode\"]}],\",\",\" \",\"继承链在这里就断了。\"]}],[\"$\",\"p\",null,{\"children\":[\"Emacs\",\" \",\"中的模式定义最后确实是定义了一个函数。然而，如果\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"'parent\"]}],\" \",\"不能求值出正确的父模式，Emacs\",\" \",\"对于\",\" \",\"mode\",\" \",\"的预设函数就会得不到期望的结果。显然，\",[\"$\",\"code\",\"1\",{\"children\":[\"coq-mode\"]}],\" \",\"不应该这样定义\",\" \",[\"$\",\"code\",\"2\",{\"children\":[\"coq--parent-mode\"]}],\".\",\" \",\"那么，到底应该怎么定义\",\" \",[\"$\",\"code\",\"3\",{\"children\":[\"coq--parent-mode\"]}],\" \",\"呢？\"]}],[\"$\",\"h2\",null,{\"className\":\"text-3xl\",\"id\":\"最终解决方案\",\"children\":[[\"$\",\"$L9\",null,{\"href\":\"#最终解决方案\",\"color\":\"secondary\",\"className\":\"pr-3 no-underline hover:underline\",\"children\":\"#\"}],[\"最终解决方案\"]]}],[\"$\",\"p\",null,{\"children\":[\"Emacs\",\" \",\"Lisp\",\" \",\"的全局变量和全局函数是不同的，这和\",\" \",\"Scheme\",\" \",\"很不一样。如果直接把\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"coq--parent-mode\"]}],\" \",\"定义为一个变量，会使得\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"coq-mode\"]}],\" \",\"无法加载。\"]}],[\"$\",\"$La\",\"49\",{\"className\":\"elisp\",\"children\":[\"(defvar coq--parent-mode\\n  (if coq-use-pg 'proof-mode 'prog-mode))\"]}],[\"$\",\"p\",null,{\"children\":[\"万幸的是，Emacs\",\" \",\"Lisp\",\" \",\"提供了一个叫做\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"defalias\"]}],\" \",\"的函数，它可以把\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"coq--parent-mode\"]}],\" \",\"定义为一个\",\" \",\"alias.\"]}],[\"$\",\"$La\",\"51\",{\"className\":\"elisp\",\"children\":[\"(defalias 'coq--parent-mode\\n  (if coq-use-pg 'proof-mode 'prog-mode))\"]}],[\"$\",\"p\",null,{\"children\":[\"上面的修改就足以使得\",\" \",\"Spacemacs\",\" \",\"可以自动侦测到\",\" \",[\"$\",\"code\",\"0\",{\"children\":[\"coq-mode\"]}],\" \",\"派生自\",\" \",[\"$\",\"code\",\"1\",{\"children\":[\"prog-mode\"]}],\"，从而开启行号显示。我已经提交了一个\",\" \",[\"$\",\"a\",\"2\",{\"href\":\"https://github.com/ProofGeneral/PG/pull/717\",\"children\":[\"PR\"]}],\"，并合入了主分支。\"]}],[\"$\",\"div\",null,{\"className\":\"notes\",\"children\":[[\"$\",\"$Lc\",null,{\"itemId\":\"1\",\"id\":\"note-1\",\"children\":[[\"$\",\"p\",null,{\"children\":[\"如果你不熟悉这种快捷键记法，可以参考\",[\"$\",\"a\",\"0\",{\"href\":\"https://kb.iu.edu/d/aghb\",\"children\":[\"文档\"]}]]}]]}]]}]]}]]}]],null],null]},[[\"$\",\"div\",null,{\"className\":\" relative w-full px-6 py-12 shadow-xl  shadow-slate-700/20 ring-1 ring-gray-900/5 dark:shadow-slate-300/20 dark:ring-gray-100/5 dark:shadow-slate-900/10 md:max-w-3xl md:mx-auto lg:max-w-4xl lg:pt-16 lg:pb-28 prose prose-natural dark:prose-invert\",\"children\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$e\",\"children\",\"posts\",\"children\",\"$f\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/ecc949282143a457.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]}]}],null],null]},[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$e\",\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"zh-cn\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__className_aaf875 text-foreground bg-background min-h-screen\",\"children\":[\"$\",\"$L11\",null,{\"children\":[\"$L12\",[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$e\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]}]}]}],null],null]},[[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/2f71e0d51b6954c9.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/cb36c8a6d34b9690.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"link\",\"2\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/ad2762ca96cee671.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$L13\"],\"globalErrorComponent\":\"$14\",\"missingSlots\":\"$W15\"}]]\n"])</script><script>self.__next_f.push([1,"16:I[56875,[\"945\",\"static/chunks/945-45c92e2d248fab37.js\",\"327\",\"static/chunks/327-1450e5f44eb18d82.js\",\"786\",\"static/chunks/786-c6fa5cb99b8c7140.js\",\"256\",\"static/chunks/256-7bc8f523a9d252a9.js\",\"203\",\"static/chunks/app/%5Blocale%5D/layout-54c8e01b9c8af01a.js\"],\"Navbar\"]\n17:I[56875,[\"945\",\"static/chunks/945-45c92e2d248fab37.js\",\"327\",\"static/chunks/327-1450e5f44eb18d82.js\",\"786\",\"static/chunks/786-c6fa5cb99b8c7140.js\",\"256\",\"static/chunks/256-7bc8f523a9d252a9.js\",\"203\",\"static/chunks/app/%5Blocale%5D/layout-54c8e01b9c8af01a.js\"],\"NavbarBrand\"]\n19:I[56875,[\"945\",\"static/chunks/945-45c92e2d248fab37.js\",\"327\",\"static/chunks/327-1450e5f44eb18d82.js\",\"786\",\"static/chunks/786-c6fa5cb99b8c7140.js\",\"256\",\"static/chunks/256-7bc8f523a9d252a9.js\",\"203\",\"static/chunks/app/%5Blocale%5D/layout-54c8e01b9c8af01a.js\"],\"NavbarItem\"]\n1b:I[56875,[\"945\",\"static/chunks/945-45c92e2d248fab37.js\",\"327\",\"static/chunks/327-1450e5f44eb18d82.js\",\"786\",\"static/chunks/786-c6fa5cb99b8c7140.js\",\"256\",\"static/chunks/256-7bc8f523a9d252a9.js\",\"203\",\"static/chunks/app/%5Blocale%5D/layout-54c8e01b9c8af01a.js\"],\"NavbarContent\"]\n1c:I[81946,[\"945\",\"static/chunks/945-45c92e2d248fab37.js\",\"327\",\"static/chunks/327-1450e5f44eb18d82.js\",\"786\",\"static/chunks/786-c6fa5cb99b8c7140.js\",\"256\",\"static/chunks/256-7bc8f523a9d252a9.js\",\"203\",\"static/chunks/app/%5Blocale%5D/layout-54c8e01b9c8af01a.js\"],\"default\"]\n1d:I[48125,[\"945\",\"static/chunks/945-45c92e2d248fab37.js\",\"327\",\"static/chunks/327-1450e5f44eb18d82.js\",\"786\",\"static/chunks/786-c6fa5cb99b8c7140.js\",\"256\",\"static/chunks/256-7bc8f523a9d252a9.js\",\"203\",\"static/chunks/app/%5Blocale%5D/layout-54c8e01b9c8af01a.js\"],\"default\"]\n12:[\"$\",\"$L16\",null,{\"shouldHideOnScroll\":true,\"children\":[[\"$\",\"$L17\",null,{\"className\":\"flex flex-row gap-4\",\"children\":[[\"$\",\"p\",null,{\"className\":\"font-bold text-inherit\",\"children\":\"$L18\"}],[\"$\",\"$L19\",null,{\"children\":\"$L1a\"}]]}],[\"$\",\"$L1b\",null,{\"justify\":\"end\",\"children\":[[\"$\",\"$L19\",null,{\"children\":[\"$\",\"$L1c\",null,{}]}],[\"$\",\"$L19\",null,{\"children\":[\"$\",\"$L1d\",null,{}]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"13:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Aya's Blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"A site powered by next.js and pandoc\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"48x48\"}],[\"$\",\"meta\",\"5\",{\"name\":\"next-size-adjust\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"1e:I[8269,[\"945\",\"static/chunks/945-45c92e2d248fab37.js\",\"327\",\"static/chunks/327-1450e5f44eb18d82.js\",\"786\",\"static/chunks/786-c6fa5cb99b8c7140.js\",\"256\",\"static/chunks/256-7bc8f523a9d252a9.js\",\"203\",\"static/chunks/app/%5Blocale%5D/layout-54c8e01b9c8af01a.js\"],\"default\"]\n18:[\"$\",\"$L1e\",null,{\"locale\":\"zh-cn\",\"localePrefix\":\"always\",\"href\":\"/\",\"children\":\"主页\"}]\n1a:[\"$\",\"$L1e\",null,{\"locale\":\"zh-cn\",\"localePrefix\":\"always\",\"href\":\"/blog/\",\"className\":\"font-bold\",\"children\":\"博客\"}]\n"])</script></body></html>