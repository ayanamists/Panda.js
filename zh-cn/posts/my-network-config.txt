3:I[8703,[],""]
6:I[3751,[],""]
7:I[9576,["464","static/chunks/a9f06191-c50ae08fb3efd389.js","793","static/chunks/793-13bb08101319ff8d.js","469","static/chunks/469-804e298465228a80.js","166","static/chunks/166-0136d06c1f62175b.js","383","static/chunks/383-60f92450fbc171c6.js","256","static/chunks/256-667b290fca3c03c4.js","203","static/chunks/app/%5Blocale%5D/layout-0f78f631c733277b.js"],"Providers"]
8:"$Sreact.suspense"
9:I[897,["464","static/chunks/a9f06191-c50ae08fb3efd389.js","793","static/chunks/793-13bb08101319ff8d.js","469","static/chunks/469-804e298465228a80.js","166","static/chunks/166-0136d06c1f62175b.js","383","static/chunks/383-60f92450fbc171c6.js","256","static/chunks/256-667b290fca3c03c4.js","203","static/chunks/app/%5Blocale%5D/layout-0f78f631c733277b.js"],"BailoutToCSR"]
a:I[8626,["464","static/chunks/a9f06191-c50ae08fb3efd389.js","793","static/chunks/793-13bb08101319ff8d.js","469","static/chunks/469-804e298465228a80.js","166","static/chunks/166-0136d06c1f62175b.js","383","static/chunks/383-60f92450fbc171c6.js","256","static/chunks/256-667b290fca3c03c4.js","203","static/chunks/app/%5Blocale%5D/layout-0f78f631c733277b.js"],"default"]
b:I[697,["464","static/chunks/a9f06191-c50ae08fb3efd389.js","793","static/chunks/793-13bb08101319ff8d.js","469","static/chunks/469-804e298465228a80.js","166","static/chunks/166-0136d06c1f62175b.js","383","static/chunks/383-60f92450fbc171c6.js","256","static/chunks/256-667b290fca3c03c4.js","203","static/chunks/app/%5Blocale%5D/layout-0f78f631c733277b.js"],"PreloadCss"]
4:["locale","zh-cn","d"]
5:["slug","my-network-config","d"]
0:["wPre4f29ajYK0seL3lnCW",[[["",{"children":[["locale","zh-cn","d"],{"children":["posts",{"children":[["slug","my-network-config","d"],{"children":["__PAGE__?{\"locale\":\"zh-cn\",\"slug\":\"my-network-config\"}",{}]}]}]}]},"$undefined","$undefined",true],["",{"children":[["locale","zh-cn","d"],{"children":["posts",{"children":[["slug","my-network-config","d"],{"children":["__PAGE__",{},[["$L1","$L2"],null],null]},[["$","div",null,{"className":" relative w-full py-12 shadow-xl shadow-slate-700/20 ring-1 ring-gray-900/5 dark:shadow-slate-100/20 dark:ring-gray-100/5 lg:mx-auto lg:max-w-4xl lg:pt-16 lg:pb-28 bg-lightwhite dark:bg-lightblack","children":["$","div",null,{"className":"prose prose-natural dark:prose-invert mx-auto max-w-full px-8 sm:px-16 relative","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","$4","children","posts","children","$5","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/845c9f7b9745d987.css","precedence":"next","crossOrigin":"$undefined"}]]}]}]}],null],null]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","$4","children","posts","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}],null]},[["$","html",null,{"lang":"zh-cn","suppressHydrationWarning":true,"children":["$","body",null,{"className":"text-foreground bg-background min-h-screen","children":["$","$L7",null,{"children":[["$","$8",null,{"fallback":null,"children":["$","$L9",null,{"reason":"next/dynamic","children":["$","$La",null,{}]}]}],["$","$8",null,{"fallback":null,"children":[["$","$Lb",null,{"moduleIds":["app/[locale]/layout.tsx -> @/components/SiteNavbar"]}],"$Lc"]}],["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]}]}]}],null],null]},[["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/289c60e965fd3941.css","precedence":"next","crossOrigin":"$undefined"}]]}],null],null],[null,[null,"$Ld"]]]]]
e:I[6619,["464","static/chunks/a9f06191-c50ae08fb3efd389.js","793","static/chunks/793-13bb08101319ff8d.js","469","static/chunks/469-804e298465228a80.js","166","static/chunks/166-0136d06c1f62175b.js","383","static/chunks/383-60f92450fbc171c6.js","256","static/chunks/256-667b290fca3c03c4.js","203","static/chunks/app/%5Blocale%5D/layout-0f78f631c733277b.js"],"Navbar"]
f:I[6619,["464","static/chunks/a9f06191-c50ae08fb3efd389.js","793","static/chunks/793-13bb08101319ff8d.js","469","static/chunks/469-804e298465228a80.js","166","static/chunks/166-0136d06c1f62175b.js","383","static/chunks/383-60f92450fbc171c6.js","256","static/chunks/256-667b290fca3c03c4.js","203","static/chunks/app/%5Blocale%5D/layout-0f78f631c733277b.js"],"NavbarContent"]
10:I[8055,["464","static/chunks/a9f06191-c50ae08fb3efd389.js","793","static/chunks/793-13bb08101319ff8d.js","469","static/chunks/469-804e298465228a80.js","166","static/chunks/166-0136d06c1f62175b.js","383","static/chunks/383-60f92450fbc171c6.js","256","static/chunks/256-667b290fca3c03c4.js","203","static/chunks/app/%5Blocale%5D/layout-0f78f631c733277b.js"],"default"]
11:I[7460,["464","static/chunks/a9f06191-c50ae08fb3efd389.js","793","static/chunks/793-13bb08101319ff8d.js","469","static/chunks/469-804e298465228a80.js","166","static/chunks/166-0136d06c1f62175b.js","383","static/chunks/383-60f92450fbc171c6.js","256","static/chunks/256-667b290fca3c03c4.js","203","static/chunks/app/%5Blocale%5D/layout-0f78f631c733277b.js"],"default"]
12:I[6619,["464","static/chunks/a9f06191-c50ae08fb3efd389.js","793","static/chunks/793-13bb08101319ff8d.js","469","static/chunks/469-804e298465228a80.js","166","static/chunks/166-0136d06c1f62175b.js","383","static/chunks/383-60f92450fbc171c6.js","256","static/chunks/256-667b290fca3c03c4.js","203","static/chunks/app/%5Blocale%5D/layout-0f78f631c733277b.js"],"NavbarItem"]
13:I[1946,["464","static/chunks/a9f06191-c50ae08fb3efd389.js","793","static/chunks/793-13bb08101319ff8d.js","469","static/chunks/469-804e298465228a80.js","166","static/chunks/166-0136d06c1f62175b.js","383","static/chunks/383-60f92450fbc171c6.js","256","static/chunks/256-667b290fca3c03c4.js","203","static/chunks/app/%5Blocale%5D/layout-0f78f631c733277b.js"],"default"]
14:I[8125,["464","static/chunks/a9f06191-c50ae08fb3efd389.js","793","static/chunks/793-13bb08101319ff8d.js","469","static/chunks/469-804e298465228a80.js","166","static/chunks/166-0136d06c1f62175b.js","383","static/chunks/383-60f92450fbc171c6.js","256","static/chunks/256-667b290fca3c03c4.js","203","static/chunks/app/%5Blocale%5D/layout-0f78f631c733277b.js"],"default"]
c:["$","$Le",null,{"shouldHideOnScroll":true,"children":[["$","$Lf",null,{"className":"flex flex-row gap-1.5","justify":"center","children":[[["$","$L10","主页",{"name":"主页","link":"/","icon":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","children":["$undefined",[["$","path","0",{"d":"M261.56 101.28a8 8 0 0 0-11.06 0L66.4 277.15a8 8 0 0 0-2.47 5.79L63.9 448a32 32 0 0 0 32 32H192a16 16 0 0 0 16-16V328a8 8 0 0 1 8-8h80a8 8 0 0 1 8 8v136a16 16 0 0 0 16 16h96.06a32 32 0 0 0 32-32V282.94a8 8 0 0 0-2.47-5.79z","children":[]}],["$","path","1",{"d":"m490.91 244.15-74.8-71.56V64a16 16 0 0 0-16-16h-48a16 16 0 0 0-16 16v32l-57.92-55.38C272.77 35.14 264.71 32 256 32c-8.68 0-16.72 3.14-22.14 8.63l-212.7 203.5c-6.22 6-7 15.87-1.34 22.37A16 16 0 0 0 43 267.56L250.5 69.28a8 8 0 0 1 11.06 0l207.52 198.28a16 16 0 0 0 22.59-.44c6.14-6.36 5.63-16.86-.76-22.97z","children":[]}]]],"className":"$undefined","style":{"color":"$undefined"},"height":"1em","width":"1em","xmlns":"http://www.w3.org/2000/svg"}]}],["$","$L10","博客",{"name":"博客","link":"/posts","icon":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","children":["$undefined",[["$","path","0",{"d":"M439.91 112h-23.82a.09.09 0 0 0-.09.09V416a32 32 0 0 0 32 32 32 32 0 0 0 32-32V152.09A40.09 40.09 0 0 0 439.91 112z","children":[]}],["$","path","1",{"d":"M384 416V72a40 40 0 0 0-40-40H72a40 40 0 0 0-40 40v352a56 56 0 0 0 56 56h342.85a1.14 1.14 0 0 0 1.15-1.15 1.14 1.14 0 0 0-.85-1.1A64.11 64.11 0 0 1 384 416zM96 128a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v64a16 16 0 0 1-16 16h-64a16 16 0 0 1-16-16zm208 272H112.45c-8.61 0-16-6.62-16.43-15.23A16 16 0 0 1 112 368h191.55c8.61 0 16 6.62 16.43 15.23A16 16 0 0 1 304 400zm0-64H112.45c-8.61 0-16-6.62-16.43-15.23A16 16 0 0 1 112 304h191.55c8.61 0 16 6.62 16.43 15.23A16 16 0 0 1 304 336zm0-64H112.45c-8.61 0-16-6.62-16.43-15.23A16 16 0 0 1 112 240h191.55c8.61 0 16 6.62 16.43 15.23A16 16 0 0 1 304 272zm0-64h-63.55c-8.61 0-16-6.62-16.43-15.23A16 16 0 0 1 240 176h63.55c8.61 0 16 6.62 16.43 15.23A16 16 0 0 1 304 208zm0-64h-63.55c-8.61 0-16-6.62-16.43-15.23A16 16 0 0 1 240 112h63.55c8.61 0 16 6.62 16.43 15.23A16 16 0 0 1 304 144z","children":[]}]]],"className":"$undefined","style":{"color":"$undefined"},"height":"1em","width":"1em","xmlns":"http://www.w3.org/2000/svg"}]}]],["$","$L11",null,{"name":"园地","item":[{"name":"格言","link":"mottos","icon":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","children":["$undefined",[["$","path","0",{"d":"M400 0H176a64.11 64.11 0 0 0-62 48h228a74 74 0 0 1 74 74v304.89l22 17.6a16 16 0 0 0 19.34.5 16.41 16.41 0 0 0 6.66-13.42V64a64 64 0 0 0-64-64z","children":[]}],["$","path","1",{"d":"M320 80H112a64 64 0 0 0-64 64v351.62A16.36 16.36 0 0 0 54.6 509a16 16 0 0 0 19.71-.71L216 388.92l141.69 119.32a16 16 0 0 0 19.6.79 16.4 16.4 0 0 0 6.71-13.44V144a64 64 0 0 0-64-64z","children":[]}]]],"className":"$undefined","style":{"color":"$undefined"},"height":"1em","width":"1em","xmlns":"http://www.w3.org/2000/svg"}]}]}]]}],["$","$Lf",null,{"justify":"end","className":"gap-0","children":[["$","$L12",null,{"children":["$","$L13",null,{}]}],["$","$L12",null,{"children":["$","$L14",null,{}]}]]}]]}]
d:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Aya's Blog"}],["$","meta","3",{"name":"description","content":"A site powered by next.js and pandoc"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"48x48"}]]
1:null
15:"$Sreact.fragment"
16:I[5164,["804","static/chunks/dccfb526-6a4014e8c6093098.js","645","static/chunks/61af6f7f-90ba238e9fdae2e2.js","793","static/chunks/793-13bb08101319ff8d.js","469","static/chunks/469-804e298465228a80.js","383","static/chunks/383-60f92450fbc171c6.js","69","static/chunks/69-b95dbc61ceb2f2b4.js","827","static/chunks/app/%5Blocale%5D/posts/%5Bslug%5D/page-17ebf6bfdeb4eb3b.js"],"default"]
17:I[5469,["804","static/chunks/dccfb526-6a4014e8c6093098.js","645","static/chunks/61af6f7f-90ba238e9fdae2e2.js","793","static/chunks/793-13bb08101319ff8d.js","469","static/chunks/469-804e298465228a80.js","383","static/chunks/383-60f92450fbc171c6.js","69","static/chunks/69-b95dbc61ceb2f2b4.js","827","static/chunks/app/%5Blocale%5D/posts/%5Bslug%5D/page-17ebf6bfdeb4eb3b.js"],""]
18:I[4272,["804","static/chunks/dccfb526-6a4014e8c6093098.js","645","static/chunks/61af6f7f-90ba238e9fdae2e2.js","793","static/chunks/793-13bb08101319ff8d.js","469","static/chunks/469-804e298465228a80.js","383","static/chunks/383-60f92450fbc171c6.js","69","static/chunks/69-b95dbc61ceb2f2b4.js","827","static/chunks/app/%5Blocale%5D/posts/%5Bslug%5D/page-17ebf6bfdeb4eb3b.js"],"default"]
19:T47d,❯ sudo nft list table inet cloudflare-warp
table inet cloudflare-warp {
        chain input {
        ...
        }

        chain output {
                type filter hook output priority filter; policy drop;
                oif "lo" accept
                oif "CloudflareWARP" goto tun
                ip saddr 0.0.0.0 ip daddr 255.255.255.255 udp sport 68 udp dport 67 accept
                meta nfproto ipv4 udp sport 67 udp dport 68 accept
                ip6 saddr fe80::/10 ip6 daddr ff02::1:2 udp sport 546 udp dport 547 accept
                ip6 saddr fe80::/10 ip6 daddr ff05::1:3 udp sport 546 udp dport 547 accept
                ip6 saddr fe80::/10 ip6 daddr fe80::/10 udp sport 547 udp dport 546 accept
                meta l4proto ipv6-icmp accept
                ip daddr 162.159.137.105 tcp dport 443 accept
                ...
                reject
        }

        chain tun {
                ip saddr 172.16.0.2 accept
                ip6 saddr 2606:4700:110:8dcf:a1af:2f13:73f3:426d accept
                ip6 saddr fe80::/10 accept
                ip protocol tcp reject with tcp reset
                reject
        }
}2:["$","div",null,{"children":[["$","h1",null,{"className":"text-4xl font-bold mb-2","children":"我是怎么上网的"}],["$","div",null,{"className":"text-sm text-gray-500 mb-5","children":"4/19/2024"}],["$","$15","0",{"children":[["$","$L16",null,{"children":[["$","ul","0",{"children":[["$","li","0",{"children":[["$","a","0",{"href":"#校园网与-vpn","id":"toc-校园网与-vpn","children":["校园网与"," ","VPN"]}]]}],["$","li","1",{"children":[["$","a","0",{"href":"#cloudflare-warp","id":"toc-cloudflare-warp","children":["Cloudflare"," ","Warp"]}]]}],["$","li","2",{"children":[["$","a","0",{"href":"#warp-的工作原理","id":"toc-warp-的工作原理","children":["Warp"," ","的工作原理"]}]]}],["$","li","3",{"children":[["$","a","0",{"href":"#不可行的方案","id":"toc-不可行的方案","children":["不可行的方案"]}]]}],["$","li","4",{"children":[["$","a","0",{"href":"#最终方案","id":"toc-最终方案","children":["最终方案"]}]]}],["$","li","5",{"children":[["$","a","0",{"href":"#总结","id":"toc-总结","children":["总结"]}]]}],["$","li","6",{"children":[["$","a","0",{"href":"#参考资料","id":"toc-参考资料","children":["参考资料"]}]]}]]}]]}],["$","article","1",{"children":[["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["如果你在南大或者中大的校园里见过我，也许你会问一个问题："]}]]}],["$","blockquote","1",{"children":[["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["为什么你只需要"]}]," ","iPad"," ",["$","span","1",{"className":"cjk","children":["就能工作（包括写代码）？"]}]]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["这个问题的答案涉及到几个方面，最重要的当然还是"]}]," ","iPad"," ",["$","span","1",{"className":"cjk","children":["上面的软件生态。但是，这里我想讲的是另一个方面：我的网络配置。"]}]]}],["$","h2",null,{"className":"text-3xl","id":"校园网与-vpn","children":[["$","$L17",null,{"href":"#校园网与-vpn","color":"secondary","className":"pr-3 no-underline hover:underline text-primary font-sans","children":"#"}],[["$","span","0",{"className":"cjk","children":["校园网与"]}]," ","VPN"]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["我首先推荐的解决方案是，"]}],["$","strong","1",{"children":[["$","span","0",{"className":"cjk","children":["在宿舍或实验室里架设一台属于自己的服务器"]}]]}],["$","span","2",{"className":"cjk","children":["。我们所有的仓库、开发环境、影音娱乐软件等等都部署在这台服务器上。那么下一个需要解决的问题是，在学校里，我们有几种需要"]}]," ",["$","q","3",{"children":[["$","span","0",{"className":"cjk","children":["移动办公"]}]]}]," ",["$","span","4",{"className":"cjk","children":["的场景："]}]]}],["$","ul","5",{"children":[["$","li","0",{"children":[["$","span","0",{"className":"cjk","children":["在图书馆里自习"]}]]}],["$","li","1",{"children":[["$","span","0",{"className":"cjk","children":["在教室里上课"]}]]}],["$","li","2",{"children":[["$","span","0",{"className":"cjk","children":["在宿舍里休息"]}]]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["可以看到，我们需要一种远程访问的手段来在学校内访问我们的服务器。理论上来说，我们可以直接暴露服务器的端口，然后在校园网里里直接访问。但是，这样做的安全问题非常严重。校内确实一般没有人会攻击我们的服务器，但是校方理论上监听了所有的流量。更重要的是，例如"]}]," ","Jellyfin"," ",["$","span","1",{"className":"cjk","children":["这样的服务，我们一般只会使用"]}]," ","http"," ",["$","span","2",{"className":"cjk","children":["来访问它，这样的话，密码以及任何其他信息都是明文传输的。"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["所以，我推荐使用"]}]," ","VPN"," ",["$","span","1",{"className":"cjk","children":["进行访问。在需要移动办公时，首先让移动设备通过"]}]," ","VPN"," ",["$","span","2",{"className":"cjk","children":["连接到服务器，然后再直接访问服务器上的服务。这样的话，我们的流量就会被加密，校方也无法监听我们的流量。我所使用的"]}]," ","VPN"," ",["$","span","3",{"className":"cjk","children":["是基于"]}]," ",["$","a","4",{"href":"https://github.com/hwdsl2/docker-ipsec-vpn-server","children":["ipsec-vpn-server"]}]," ",["$","span","5",{"className":"cjk","children":["的，它搭建的"]}]," ","ikev2"," ","VPN"," ",["$","span","6",{"className":"cjk","children":["必须通过私钥证书进行连接，非常安全。"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["我把这个服务跑在了"]}]," ","Docker"," ",["$","span","1",{"className":"cjk","children":["里面："]}]]}],["$","div",null,{"className":"border border-solid rounded-md not-prose border-zinc-400 relative","children":[["$","$L18",null,{"code":["❯ docker container ls | rg ipsec\nb13ca7eb8233   hwdsl2/ipsec-vpn-server   \"/opt/src/run.sh\"   2 months ago   Up 6 days   0.0.0.0:500->500/udp, :::500->500/udp, 0.0.0.0:4500->4500/udp, :::4500->4500/udp   "]}],["$","pre",null,{"style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","margin":".5em 0","overflow":"auto","background":"var(--theme-background-color)"},"children":["$","code",null,{"className":"language-bash","style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","line-number--1",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[1]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["❯ "]}],["$","span","code-segement2",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["docker"]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":[" container "]}],["$","span","code-segement4",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["ls"]}],["$","span","code-segement5",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement6",{"className":"token","style":{"color":"var(--theme-operator-color)"},"children":["|"]}],["$","span","code-segement7",{"className":"$undefined","style":{},"children":[" rg ipsec\n"]}],["$","span","line-number--2",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[2]}],["$","span","code-segement9",{"className":"$undefined","style":{},"children":["b13ca7eb8233   hwdsl2/ipsec-vpn-server   "]}],["$","span","code-segement10",{"className":"token","style":{"color":"var(--theme-string-color)"},"children":["\"/opt/src/run.sh\""]}],["$","span","code-segement11",{"className":"$undefined","style":{},"children":["   "]}],["$","span","code-segement12",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["2"]}],["$","span","code-segement13",{"className":"$undefined","style":{},"children":[" months ago   Up "]}],["$","span","code-segement14",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["6"]}],["$","span","code-segement15",{"className":"$undefined","style":{},"children":[" days   "]}],["$","span","code-segement16",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0.0"]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":[".0.0:500-"]}],["$","span","code-segement18",{"className":"token","style":{"color":"var(--theme-operator-color)"},"children":[">"]}],["$","span","code-segement19",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["500"]}],["$","span","code-segement20",{"className":"$undefined","style":{},"children":["/udp, :::500-"]}],["$","span","code-segement21",{"className":"token","style":{"color":"var(--theme-operator-color)"},"children":[">"]}],["$","span","code-segement22",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["500"]}],["$","span","code-segement23",{"className":"$undefined","style":{},"children":["/udp, "]}],["$","span","code-segement24",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0.0"]}],["$","span","code-segement25",{"className":"$undefined","style":{},"children":[".0.0:4500-"]}],["$","span","code-segement26",{"className":"token","style":{"color":"var(--theme-operator-color)"},"children":[">"]}],["$","span","code-segement27",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["4500"]}],["$","span","code-segement28",{"className":"$undefined","style":{},"children":["/udp, :::4500-"]}],["$","span","code-segement29",{"className":"token","style":{"color":"var(--theme-operator-color)"},"children":[">"]}],["$","span","code-segement30",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["4500"]}],["$","span","code-segement31",{"className":"$undefined","style":{},"children":["/udp   "]}]]]}]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["可以看到，它只占用了"]}]," ","500"," ",["$","span","1",{"className":"cjk","children":["和"]}]," ","4500"," ",["$","span","2",{"className":"cjk","children":["两个端口。这样一来，你只需要在"]}]," ","iptables"," ",["$","span","3",{"className":"cjk","children":["开放这两个端口即可，其他的都可以关闭。事实上，我没有直接把这台服务器连接到校园网，而是通过一个路由器连接到校园网，服务器连接在路由器创建的内网里。我只需要在路由器的端口转发里面把这两个端口转发到服务器上，就可以在校园网里访问"]}]," ","VPN"," ",["$","span","4",{"className":"cjk","children":["了。"]}]]}],["$","h2",null,{"className":"text-3xl","id":"cloudflare-warp","children":[["$","$L17",null,{"href":"#cloudflare-warp","color":"secondary","className":"pr-3 no-underline hover:underline text-primary font-sans","children":"#"}],["Cloudflare"," ","Warp"]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["中国的网络环境，有一些比较复杂的问题。我们有些时候必须使用一些特殊的服务来加速国外网络的连接。我推荐的服务是"]}]," ","Cloudflare"," ","Warp。它是一个基于"," ","WireGuard"," ",["$","span","1",{"className":"cjk","children":["的"]}]," ","VPN"," ",["$","span","2",{"className":"cjk","children":["服务。然而这是比较"]}]," ",["$","q","3",{"children":[["$","span","0",{"className":"cjk","children":["非主流"]}]]}]," ",["$","span","4",{"className":"cjk","children":["的解决方案，它具有一个比较大的问题，那就是无法"]}]," ",["$","q","5",{"children":[["$","span","0",{"className":"cjk","children":["分流"]}]]}],["$","span","6",{"className":"cjk","children":["。"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["所谓的"]}]," ",["$","q","1",{"children":[["$","span","0",{"className":"cjk","children":["分流"]}]]}],["$","span","2",{"className":"cjk","children":["，简单来说就是国内的流量不走"]}]," ","Warp，国外的流量走"," ","Warp."," ",["$","span","3",{"className":"cjk","children":["这样的话，我们可以避免一些国内的服务因为走"]}]," ","Warp"," ",["$","span","4",{"className":"cjk","children":["而变得不可用。这个特性本质上是一种用户态的路由，一些"]}]," ",["$","q","5",{"children":[["$","span","0",{"className":"cjk","children":["主流"]}]]}]," ",["$","span","6",{"className":"cjk","children":["的解决方案都支持这个特性。"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["有三种简单的解决方案来解决这个问题："]}]]}],["$","ul","15",{"children":[["$","li","0",{"children":[["$","span","0",{"className":"cjk","children":["手动切换。这个方法最简单，但是也最不方便。每次需要访问国外的服务时，我们需要手动切换到"]}]," ","Warp."," ",["$","span","1",{"className":"cjk","children":["显然，这是不太合适的。"]}]]}],["$","li","1",{"children":[["$","span","0",{"className":"cjk","children":["使用"]}]," ","Warp"," ",["$","span","1",{"className":"cjk","children":["提供的"]}]," ",["$","a","2",{"href":"https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/route-traffic/split-tunnels/","children":["Split"," ","Tunnel"]}]," ",["$","span","3",{"className":"cjk","children":["功能。这个功能支持对于特定的"]}]," ","IP"," ","地址或域名进行分流。然而，Cloudflare"," ",["$","span","4",{"className":"cjk","children":["没有提供任何"]}]," ","API"," ",["$","span","5",{"className":"cjk","children":["来自动化地配置这个功能。也就是说，如果你想让"]}]," ","bilibili"," ",["$","span","6",{"className":"cjk","children":["服务不走"]}]," ","Warp，你需要手工把"," ","bilibili"," ",["$","span","7",{"className":"cjk","children":["的全部域名（大概可能有"]}]," ","30"," ",["$","span","8",{"className":"cjk","children":["个以上）一个个地用"]}]," ","Web"," ",["$","span","9",{"className":"cjk","children":["界面添加到"]}]," ","Split"," ","Tunnel"," ",["$","span","10",{"className":"cjk","children":["里面。"]}]]}],["$","li","2",{"children":[["$","span","0",{"className":"cjk","children":["使用混合方案，开一台虚拟机，让虚拟机走"]}]," ","Warp，然后在主机里使用"," ",["$","q","1",{"children":[["$","span","0",{"className":"cjk","children":["主流"]}]]}]," ",["$","span","2",{"className":"cjk","children":["方案进行分流。这是比较可行的方案，然而，"]}],["$","q","3",{"children":[["$","span","0",{"className":"cjk","children":["主流"]}]]}]," ",["$","span","4",{"className":"cjk","children":["的透明代理方案经常和"]}]," ","Docker"," ",["$","span","5",{"className":"cjk","children":["有冲突，我也不喜欢这种方案。"]}]]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["这三种方案似乎都不太合理。这里看起来必须要仔细研究一下"]}]," ","Warp"," ",["$","span","1",{"className":"cjk","children":["到底是如何工作的，才能找到一个更好的解决方案。"]}]]}],["$","h2",null,{"className":"text-3xl","id":"warp-的工作原理","children":[["$","$L17",null,{"href":"#warp-的工作原理","color":"secondary","className":"pr-3 no-underline hover:underline text-primary font-sans","children":"#"}],["Warp"," ",["$","span","0",{"className":"cjk","children":["的工作原理"]}]]]}],["$","p",null,{"children":["Warp"," ",["$","span","0",{"className":"cjk","children":["作为一个"]}]," ","VPN，首先会创建一个虚拟网卡。然后，所有的流量都会被发送到这个虚拟网卡上。观察到它是很简单的："]}],["$","div",null,{"className":"border border-solid rounded-md not-prose border-zinc-400 relative","children":[["$","$L18",null,{"code":["❯ ifconfig | rg Cloudflare -A 10\nCloudflareWARP: flags=4305<UP,POINTOPOINT,RUNNING,NOARP,MULTICAST>  mtu 1280\n        inet 172.16.0.2  netmask 255.255.255.255  destination 172.16.0.2\n        inet6 fe80::bcc8:7a58:8e3a:d8d8  prefixlen 64  scopeid 0x20<link>\n        inet6 2606:4700:110:8dcf:a1af:2f13:73f3:426d  prefixlen 128  scopeid 0x0<global>\n        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 500  (UNSPEC)\n        RX packets 2607433  bytes 790963841 (790.9 MB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 6150386  bytes 4399939541 (4.3 GB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0"]}],["$","pre",null,{"style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","margin":".5em 0","overflow":"auto","background":"var(--theme-background-color)"},"children":["$","code",null,{"className":"language-bash","style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","line-number--1",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[1]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["❯ "]}],["$","span","code-segement2",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["ifconfig"]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement4",{"className":"token","style":{"color":"var(--theme-operator-color)"},"children":["|"]}],["$","span","code-segement5",{"className":"$undefined","style":{},"children":[" rg Cloudflare -A "]}],["$","span","code-segement6",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10"]}],["$","span","code-segement7",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--2",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[2]}],["$","span","code-segement9",{"className":"$undefined","style":{},"children":["CloudflareWARP: "]}],["$","span","code-segement10",{"className":"token assign-left","style":{"color":"var(--theme-variable-color)"},"children":["flags"]}],["$","span","code-segement11",{"className":"token","style":{"color":"var(--theme-operator-color)"},"children":["="]}],["$","span","code-segement12",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["430"]}],["$","span","code-segement13",{"className":"token file-descriptor","style":{"color":"var(--theme-important-color)","fontWeight":"bold"},"children":["5"]}],["$","span","code-segement14",{"className":"token","style":{"color":"var(--theme-operator-color)"},"children":["<"]}],["$","span","code-segement15",{"className":"$undefined","style":{},"children":["UP,POINTOPOINT,RUNNING,NOARP,MULTICAST"]}],["$","span","code-segement16",{"className":"token","style":{"color":"var(--theme-operator-color)"},"children":[">"]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":["  mtu "]}],["$","span","code-segement18",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["1280"]}],["$","span","code-segement19",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--3",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[3]}],["$","span","code-segement21",{"className":"$undefined","style":{},"children":["        inet "]}],["$","span","code-segement22",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["172.16"]}],["$","span","code-segement23",{"className":"$undefined","style":{},"children":[".0.2  netmask "]}],["$","span","code-segement24",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["255.255"]}],["$","span","code-segement25",{"className":"$undefined","style":{},"children":[".255.255  destination "]}],["$","span","code-segement26",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["172.16"]}],["$","span","code-segement27",{"className":"$undefined","style":{},"children":[".0.2\n"]}],["$","span","line-number--4",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[4]}],["$","span","code-segement29",{"className":"$undefined","style":{},"children":["        inet6 fe80::bcc8:7a58:8e3a:d8d8  prefixlen "]}],["$","span","code-segement30",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["64"]}],["$","span","code-segement31",{"className":"$undefined","style":{},"children":["  scopeid 0x2"]}],["$","span","code-segement32",{"className":"token file-descriptor","style":{"color":"var(--theme-important-color)","fontWeight":"bold"},"children":["0"]}],["$","span","code-segement33",{"className":"token","style":{"color":"var(--theme-operator-color)"},"children":["<"]}],["$","span","code-segement34",{"className":"$undefined","style":{},"children":["link"]}],["$","span","code-segement35",{"className":"token","style":{"color":"var(--theme-operator-color)"},"children":[">"]}],["$","span","code-segement36",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--5",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[5]}],["$","span","code-segement38",{"className":"$undefined","style":{},"children":["        inet6 "]}],["$","span","code-segement39",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["2606"]}],["$","span","code-segement40",{"className":"$undefined","style":{},"children":[":4700:110:8dcf:a1af:2f13:73f3:426d  prefixlen "]}],["$","span","code-segement41",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["128"]}],["$","span","code-segement42",{"className":"$undefined","style":{},"children":["  scopeid 0x"]}],["$","span","code-segement43",{"className":"token file-descriptor","style":{"color":"var(--theme-important-color)","fontWeight":"bold"},"children":["0"]}],["$","span","code-segement44",{"className":"token","style":{"color":"var(--theme-operator-color)"},"children":["<"]}],["$","span","code-segement45",{"className":"$undefined","style":{},"children":["global"]}],["$","span","code-segement46",{"className":"token","style":{"color":"var(--theme-operator-color)"},"children":[">"]}],["$","span","code-segement47",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--6",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[6]}],["$","span","code-segement49",{"className":"$undefined","style":{},"children":["        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen "]}],["$","span","code-segement50",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["500"]}],["$","span","code-segement51",{"className":"$undefined","style":{},"children":["  "]}],["$","span","code-segement52",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":["("]}],["$","span","code-segement53",{"className":"$undefined","style":{},"children":["UNSPEC"]}],["$","span","code-segement54",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":[")"]}],["$","span","code-segement55",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--7",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[7]}],["$","span","code-segement57",{"className":"$undefined","style":{},"children":["        RX packets "]}],["$","span","code-segement58",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["2607433"]}],["$","span","code-segement59",{"className":"$undefined","style":{},"children":["  bytes "]}],["$","span","code-segement60",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["790963841"]}],["$","span","code-segement61",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement62",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":["("]}],["$","span","code-segement63",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["790.9"]}],["$","span","code-segement64",{"className":"$undefined","style":{},"children":[" MB"]}],["$","span","code-segement65",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":[")"]}],["$","span","code-segement66",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--8",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[8]}],["$","span","code-segement68",{"className":"$undefined","style":{},"children":["        RX errors "]}],["$","span","code-segement69",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0"]}],["$","span","code-segement70",{"className":"$undefined","style":{},"children":["  dropped "]}],["$","span","code-segement71",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0"]}],["$","span","code-segement72",{"className":"$undefined","style":{},"children":["  overruns "]}],["$","span","code-segement73",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0"]}],["$","span","code-segement74",{"className":"$undefined","style":{},"children":["  frame "]}],["$","span","code-segement75",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0"]}],["$","span","code-segement76",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--9",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[9]}],["$","span","code-segement78",{"className":"$undefined","style":{},"children":["        TX packets "]}],["$","span","code-segement79",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["6150386"]}],["$","span","code-segement80",{"className":"$undefined","style":{},"children":["  bytes "]}],["$","span","code-segement81",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["4399939541"]}],["$","span","code-segement82",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement83",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":["("]}],["$","span","code-segement84",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["4.3"]}],["$","span","code-segement85",{"className":"$undefined","style":{},"children":[" GB"]}],["$","span","code-segement86",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":[")"]}],["$","span","code-segement87",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--10",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[10]}],["$","span","code-segement89",{"className":"$undefined","style":{},"children":["        TX errors "]}],["$","span","code-segement90",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0"]}],["$","span","code-segement91",{"className":"$undefined","style":{},"children":["  dropped "]}],["$","span","code-segement92",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0"]}],["$","span","code-segement93",{"className":"$undefined","style":{},"children":[" overruns "]}],["$","span","code-segement94",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0"]}],["$","span","code-segement95",{"className":"$undefined","style":{},"children":["  carrier "]}],["$","span","code-segement96",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0"]}],["$","span","code-segement97",{"className":"$undefined","style":{},"children":["  collisions "]}],["$","span","code-segement98",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0"]}]]]}]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["一个直觉的问题是，数据包是怎么被"]}]," ",["$","q","1",{"children":[["$","span","0",{"className":"cjk","children":["劫持"]}]]}]," ",["$","span","2",{"className":"cjk","children":["到这个虚拟网卡上的呢？"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["理论上来说，这种工作是由路由表完成的。我们可以通过"]}]," ",["$","code","1",{"children":["ip route"]}]," ",["$","span","2",{"className":"cjk","children":["命令来查看路由表："]}]]}],["$","div",null,{"className":"border border-solid rounded-md not-prose border-zinc-400 relative","children":[["$","$L18",null,{"code":["❯ ip route\ndefault via 192.168.1.1 dev enp34s0 proto dhcp metric 20100 \n10.10.0.0/24 dev docker0 proto kernel scope link src 10.10.0.1 \n10.10.1.0/24 dev br-bb1b34f83079 proto kernel scope link src 10.10.1.1 \n10.10.2.0/24 dev br-cbd63cef39db proto kernel scope link src 10.10.2.1 \n10.10.3.0/24 dev br-fbf2794de605 proto kernel scope link src 10.10.3.1 \n10.10.4.0/24 dev br-81377bc74af2 proto kernel scope link src 10.10.4.1 \n10.10.5.0/24 dev br-6dba9d07a5e4 proto kernel scope link src 10.10.5.1 \n10.10.12.0/24 dev br-1e11e9d90ce2 proto kernel scope link src 10.10.12.1 \n10.10.19.0/24 dev br-d4a69960927a proto kernel scope link src 10.10.19.1 \n10.10.21.0/24 dev br-e5a33351bb28 proto kernel scope link src 10.10.21.1 \n10.10.100.0/24 dev br-9c1f570184a3 proto kernel scope link src 10.10.100.1 \n169.254.0.0/16 dev br-fbf2794de605 scope link metric 1000 \n192.168.1.0/24 dev enp34s0 proto kernel scope link src 192.168.1.185 metric 100"]}],["$","pre",null,{"style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","margin":".5em 0","overflow":"auto","background":"var(--theme-background-color)"},"children":["$","code",null,{"className":"language-bash","style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","line-number--1",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[1]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["❯ "]}],["$","span","code-segement2",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["ip"]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":[" route\n"]}],["$","span","line-number--2",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[2]}],["$","span","code-segement5",{"className":"$undefined","style":{},"children":["default via "]}],["$","span","code-segement6",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["192.168"]}],["$","span","code-segement7",{"className":"$undefined","style":{},"children":[".1.1 dev enp34s0 proto dhcp metric "]}],["$","span","code-segement8",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["20100"]}],["$","span","code-segement9",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--3",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[3]}],["$","span","code-segement11",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement12",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement13",{"className":"$undefined","style":{},"children":[".0.0/24 dev docker0 proto kernel scope "]}],["$","span","code-segement14",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement15",{"className":"$undefined","style":{},"children":[" src "]}],["$","span","code-segement16",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":[".0.1 \n"]}],["$","span","line-number--4",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[4]}],["$","span","code-segement19",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement20",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement21",{"className":"$undefined","style":{},"children":[".1.0/24 dev br-bb1b34f83079 proto kernel scope "]}],["$","span","code-segement22",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement23",{"className":"$undefined","style":{},"children":[" src "]}],["$","span","code-segement24",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement25",{"className":"$undefined","style":{},"children":[".1.1 \n"]}],["$","span","line-number--5",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[5]}],["$","span","code-segement27",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement28",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement29",{"className":"$undefined","style":{},"children":[".2.0/24 dev br-cbd63cef39db proto kernel scope "]}],["$","span","code-segement30",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement31",{"className":"$undefined","style":{},"children":[" src "]}],["$","span","code-segement32",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement33",{"className":"$undefined","style":{},"children":[".2.1 \n"]}],["$","span","line-number--6",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[6]}],["$","span","code-segement35",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement36",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement37",{"className":"$undefined","style":{},"children":[".3.0/24 dev br-fbf2794de605 proto kernel scope "]}],["$","span","code-segement38",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement39",{"className":"$undefined","style":{},"children":[" src "]}],["$","span","code-segement40",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement41",{"className":"$undefined","style":{},"children":[".3.1 \n"]}],["$","span","line-number--7",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[7]}],["$","span","code-segement43",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement44",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement45",{"className":"$undefined","style":{},"children":[".4.0/24 dev br-81377bc74af2 proto kernel scope "]}],["$","span","code-segement46",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement47",{"className":"$undefined","style":{},"children":[" src "]}],["$","span","code-segement48",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement49",{"className":"$undefined","style":{},"children":[".4.1 \n"]}],["$","span","line-number--8",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[8]}],["$","span","code-segement51",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement52",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement53",{"className":"$undefined","style":{},"children":[".5.0/24 dev br-6dba9d07a5e4 proto kernel scope "]}],["$","span","code-segement54",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement55",{"className":"$undefined","style":{},"children":[" src "]}],["$","span","code-segement56",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement57",{"className":"$undefined","style":{},"children":[".5.1 \n"]}],["$","span","line-number--9",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[9]}],["$","span","code-segement59",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement60",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement61",{"className":"$undefined","style":{},"children":[".12.0/24 dev br-1e11e9d90ce2 proto kernel scope "]}],["$","span","code-segement62",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement63",{"className":"$undefined","style":{},"children":[" src "]}],["$","span","code-segement64",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement65",{"className":"$undefined","style":{},"children":[".12.1 \n"]}],["$","span","line-number--10",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[10]}],["$","span","code-segement67",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement68",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement69",{"className":"$undefined","style":{},"children":[".19.0/24 dev br-d4a69960927a proto kernel scope "]}],["$","span","code-segement70",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement71",{"className":"$undefined","style":{},"children":[" src "]}],["$","span","code-segement72",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement73",{"className":"$undefined","style":{},"children":[".19.1 \n"]}],["$","span","line-number--11",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[11]}],["$","span","code-segement75",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement76",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement77",{"className":"$undefined","style":{},"children":[".21.0/24 dev br-e5a33351bb28 proto kernel scope "]}],["$","span","code-segement78",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement79",{"className":"$undefined","style":{},"children":[" src "]}],["$","span","code-segement80",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement81",{"className":"$undefined","style":{},"children":[".21.1 \n"]}],["$","span","line-number--12",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[12]}],["$","span","code-segement83",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement84",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement85",{"className":"$undefined","style":{},"children":[".100.0/24 dev br-9c1f570184a3 proto kernel scope "]}],["$","span","code-segement86",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement87",{"className":"$undefined","style":{},"children":[" src "]}],["$","span","code-segement88",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10.10"]}],["$","span","code-segement89",{"className":"$undefined","style":{},"children":[".100.1 \n"]}],["$","span","line-number--13",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[13]}],["$","span","code-segement91",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement92",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["169.254"]}],["$","span","code-segement93",{"className":"$undefined","style":{},"children":[".0.0/16 dev br-fbf2794de605 scope "]}],["$","span","code-segement94",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement95",{"className":"$undefined","style":{},"children":[" metric "]}],["$","span","code-segement96",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["1000"]}],["$","span","code-segement97",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--14",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[14]}],["$","span","code-segement99",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement100",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["192.168"]}],["$","span","code-segement101",{"className":"$undefined","style":{},"children":[".1.0/24 dev enp34s0 proto kernel scope "]}],["$","span","code-segement102",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement103",{"className":"$undefined","style":{},"children":[" src "]}],["$","span","code-segement104",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["192.168"]}],["$","span","code-segement105",{"className":"$undefined","style":{},"children":[".1.185 metric "]}],["$","span","code-segement106",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["100"]}]]]}]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["然而，这里似乎没有任何与"]}]," ","Warp"," ","相关的路由。事实上，和大部分人想象的不同，Linux"," ",["$","span","1",{"className":"cjk","children":["的路由结构还是比较复杂的。"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["现代的"]}]," ","Linux"," ",["$","span","1",{"className":"cjk","children":["支持一种叫做"]}]," ",["$","q","2",{"children":["policy"," ","routing"]}]," ","的机制。传统的路由算法仅仅依照目的地址进行路由判定，但事实上，很多时候需要通过一些其他信息（源地址、端口、协议……）进行路由选择，所以"," ","Linux"," ",["$","span","3",{"className":"cjk","children":["使用了一种"]}]," ",["$","q","4",{"children":[["$","span","0",{"className":"cjk","children":["两级"]}]]}]," ",["$","span","5",{"className":"cjk","children":["的结构，"]}]]}],["$","ul","25",{"children":[["$","li","0",{"children":[["$","span","0",{"className":"cjk","children":["由"]}]," ",["$","code","1",{"children":["ip route"]}]," ",["$","span","2",{"className":"cjk","children":["管理的路由表进行具体的路由选择"]}]]}],["$","li","1",{"children":[["$","span","0",{"className":"cjk","children":["路由表可能有很多张，由"]}]," ",["$","code","1",{"children":["ip rule"]}]," ",["$","span","2",{"className":"cjk","children":["根据策略规则选择使用什么路由表。路由表匹配可能失败，如果失败就几乎回到"]}]," ",["$","code","3",{"children":["ip rule"]}]," ",["$","span","4",{"className":"cjk","children":["匹配下一个可能的规则。"]}]]}]]}],["$","div",null,{"className":"border border-solid rounded-md not-prose border-zinc-400 relative","children":[["$","$L18",null,{"code":["❯ ip rule\n0:      from all lookup local\n32765:  not from all fwmark 0x100cf lookup 65743\n32766:  from all lookup main\n32767:  from all lookup default"]}],["$","pre",null,{"style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","margin":".5em 0","overflow":"auto","background":"var(--theme-background-color)"},"children":["$","code",null,{"className":"language-bash","style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","line-number--1",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[1]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["❯ "]}],["$","span","code-segement2",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["ip"]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":[" rule\n"]}],["$","span","line-number--2",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[2]}],["$","span","code-segement5",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement6",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0"]}],["$","span","code-segement7",{"className":"$undefined","style":{},"children":[":      from all lookup "]}],["$","span","code-segement8",{"className":"token","style":{"color":"var(--theme-class-name-color)","textDecoration":"underline"},"children":["local"]}],["$","span","code-segement9",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--3",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[3]}],["$","span","code-segement11",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement12",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["32765"]}],["$","span","code-segement13",{"className":"$undefined","style":{},"children":[":  not from all fwmark 0x100cf lookup "]}],["$","span","code-segement14",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["65743"]}],["$","span","code-segement15",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--4",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[4]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement18",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["32766"]}],["$","span","code-segement19",{"className":"$undefined","style":{},"children":[":  from all lookup main\n"]}],["$","span","line-number--5",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[5]}],["$","span","code-segement21",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement22",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["32767"]}],["$","span","code-segement23",{"className":"$undefined","style":{},"children":[":  from all lookup default"]}]]]}]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["可以看到，这里有四张路由表，分别是"]}]," ",["$","code","1",{"children":["local"]}],","," ",["$","code","2",{"children":["main"]}],","," ",["$","code","3",{"children":["default"]}]," ",["$","span","4",{"className":"cjk","children":["和"]}]," ",["$","code","5",{"children":["65743"]}],["$","span","6",{"className":"cjk","children":["，前面三张表是"]}]," ","Linux"," ",["$","span","7",{"className":"cjk","children":["在启动时自动创建的。而"]}]," ",["$","code","8",{"children":["65743"]}]," ",["$","span","9",{"className":"cjk","children":["是"]}]," ","Warp"," ",["$","span","10",{"className":"cjk","children":["创建的。这条规则的意思很明确：如果这个数据包没有被打上"]}]," ",["$","code","11",{"children":["0x100cf"]}]," ",["$","span","12",{"className":"cjk","children":["标记的话，那么使用"]}]," ",["$","code","13",{"children":["65743"]}]," ","路由表来处理它。自然地，我们会想到，Warp"," ",["$","span","14",{"className":"cjk","children":["的出口流量会打上"]}]," ",["$","code","15",{"children":["0x100cf"]}]," ","标记，以避免回环问题（Warp"," ",["$","span","16",{"className":"cjk","children":["的出口流量又被发送到"]}]," ","Warp，造成无限循环）。"]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["而路由表"]}]," ",["$","code","1",{"children":["65743"]}]," ",["$","span","2",{"className":"cjk","children":["可能会非常复杂，比如在我的服务器上："]}]]}],["$","div",null,{"className":"border border-solid rounded-md not-prose border-zinc-400 relative","children":[["$","$L18",null,{"code":["❯ ip route show table 65743\n0.0.0.0/5 dev CloudflareWARP proto static scope link \n8.0.0.0/7 dev CloudflareWARP proto static scope link \n11.0.0.0/8 dev CloudflareWARP proto static scope link \n12.0.0.0/6 dev CloudflareWARP proto static scope link \n16.0.0.0/4 dev CloudflareWARP proto static scope link \n32.0.0.0/3 dev CloudflareWARP proto static scope link \n64.0.0.0/3 dev CloudflareWARP proto static scope link \n96.0.0.0/4 dev CloudflareWARP proto static scope link \n112.0.0.0/7 dev CloudflareWARP proto static scope link \n114.0.0.0/9 dev CloudflareWARP proto static scope link \n114.128.0.0/10 dev CloudflareWARP proto static scope link \n114.192.0.0/12 dev CloudflareWARP proto static scope link \n114.208.0.0/14 dev CloudflareWARP proto static scope link \n114.213.0.0/16 dev CloudflareWARP proto static scope link \n114.214.0.0/15 dev CloudflareWARP proto static scope link \n114.216.0.0/13 dev CloudflareWARP proto static scope link \n114.224.0.0/11 dev CloudflareWARP proto static scope link \n... (about 200 lines)"]}],["$","pre",null,{"style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","margin":".5em 0","overflow":"auto","background":"var(--theme-background-color)"},"children":["$","code",null,{"className":"language-bash","style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","line-number--1",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[1]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["❯ "]}],["$","span","code-segement2",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["ip"]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":[" route show table "]}],["$","span","code-segement4",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["65743"]}],["$","span","code-segement5",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--2",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[2]}],["$","span","code-segement7",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement8",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0.0"]}],["$","span","code-segement9",{"className":"$undefined","style":{},"children":[".0.0/5 dev CloudflareWARP proto static scope "]}],["$","span","code-segement10",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement11",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--3",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[3]}],["$","span","code-segement13",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement14",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["8.0"]}],["$","span","code-segement15",{"className":"$undefined","style":{},"children":[".0.0/7 dev CloudflareWARP proto static scope "]}],["$","span","code-segement16",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--4",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[4]}],["$","span","code-segement19",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement20",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["11.0"]}],["$","span","code-segement21",{"className":"$undefined","style":{},"children":[".0.0/8 dev CloudflareWARP proto static scope "]}],["$","span","code-segement22",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement23",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--5",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[5]}],["$","span","code-segement25",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement26",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["12.0"]}],["$","span","code-segement27",{"className":"$undefined","style":{},"children":[".0.0/6 dev CloudflareWARP proto static scope "]}],["$","span","code-segement28",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement29",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--6",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[6]}],["$","span","code-segement31",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement32",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["16.0"]}],["$","span","code-segement33",{"className":"$undefined","style":{},"children":[".0.0/4 dev CloudflareWARP proto static scope "]}],["$","span","code-segement34",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement35",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--7",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[7]}],["$","span","code-segement37",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement38",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["32.0"]}],["$","span","code-segement39",{"className":"$undefined","style":{},"children":[".0.0/3 dev CloudflareWARP proto static scope "]}],["$","span","code-segement40",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement41",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--8",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[8]}],["$","span","code-segement43",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement44",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["64.0"]}],["$","span","code-segement45",{"className":"$undefined","style":{},"children":[".0.0/3 dev CloudflareWARP proto static scope "]}],["$","span","code-segement46",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement47",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--9",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[9]}],["$","span","code-segement49",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement50",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["96.0"]}],["$","span","code-segement51",{"className":"$undefined","style":{},"children":[".0.0/4 dev CloudflareWARP proto static scope "]}],["$","span","code-segement52",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement53",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--10",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[10]}],["$","span","code-segement55",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement56",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["112.0"]}],["$","span","code-segement57",{"className":"$undefined","style":{},"children":[".0.0/7 dev CloudflareWARP proto static scope "]}],["$","span","code-segement58",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement59",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--11",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[11]}],["$","span","code-segement61",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement62",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["114.0"]}],["$","span","code-segement63",{"className":"$undefined","style":{},"children":[".0.0/9 dev CloudflareWARP proto static scope "]}],["$","span","code-segement64",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement65",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--12",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[12]}],["$","span","code-segement67",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement68",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["114.128"]}],["$","span","code-segement69",{"className":"$undefined","style":{},"children":[".0.0/10 dev CloudflareWARP proto static scope "]}],["$","span","code-segement70",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement71",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--13",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[13]}],["$","span","code-segement73",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement74",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["114.192"]}],["$","span","code-segement75",{"className":"$undefined","style":{},"children":[".0.0/12 dev CloudflareWARP proto static scope "]}],["$","span","code-segement76",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement77",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--14",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[14]}],["$","span","code-segement79",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement80",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["114.208"]}],["$","span","code-segement81",{"className":"$undefined","style":{},"children":[".0.0/14 dev CloudflareWARP proto static scope "]}],["$","span","code-segement82",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement83",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--15",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[15]}],["$","span","code-segement85",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement86",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["114.213"]}],["$","span","code-segement87",{"className":"$undefined","style":{},"children":[".0.0/16 dev CloudflareWARP proto static scope "]}],["$","span","code-segement88",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement89",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--16",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[16]}],["$","span","code-segement91",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement92",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["114.214"]}],["$","span","code-segement93",{"className":"$undefined","style":{},"children":[".0.0/15 dev CloudflareWARP proto static scope "]}],["$","span","code-segement94",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement95",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--17",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[17]}],["$","span","code-segement97",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement98",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["114.216"]}],["$","span","code-segement99",{"className":"$undefined","style":{},"children":[".0.0/13 dev CloudflareWARP proto static scope "]}],["$","span","code-segement100",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement101",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--18",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[18]}],["$","span","code-segement103",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement104",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["114.224"]}],["$","span","code-segement105",{"className":"$undefined","style":{},"children":[".0.0/11 dev CloudflareWARP proto static scope "]}],["$","span","code-segement106",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement107",{"className":"$undefined","style":{},"children":[" \n"]}],["$","span","line-number--19",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[19]}],["$","span","code-segement109",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement110",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":[".."]}],["$","span","code-segement111",{"className":"$undefined","style":{},"children":[". "]}],["$","span","code-segement112",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":["("]}],["$","span","code-segement113",{"className":"$undefined","style":{},"children":["about "]}],["$","span","code-segement114",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["200"]}],["$","span","code-segement115",{"className":"$undefined","style":{},"children":[" lines"]}],["$","span","code-segement116",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":[")"]}]]]}]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["为什么会这么多规则呢？"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["这就要说到"]}]," ","Split"," ","Tunnel"," ","了。Split"," ","Tunnel"," ",["$","span","1",{"className":"cjk","children":["的功能是通过这些路由规则实现的。"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["具体来说，如果默认的只有这一条（所有的流量都发送到"]}]," ","Warp"," ",["$","span","1",{"className":"cjk","children":["的虚拟网卡）的话："]}]]}],["$","div",null,{"className":"border border-solid rounded-md not-prose border-zinc-400 relative","children":[["$","$L18",null,{"code":["0.0.0.0/0 dev CloudflareWARP proto static scope link"]}],["$","pre",null,{"style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","margin":".5em 0","overflow":"auto","background":"var(--theme-background-color)"},"children":["$","code",null,{"className":"language-bash","style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","line-number--1",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[1]}],["$","span","code-segement1",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0.0"]}],["$","span","code-segement2",{"className":"$undefined","style":{},"children":[".0.0/0 dev CloudflareWARP proto static scope "]}],["$","span","code-segement3",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}]]]}]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["现在我们添加了一条规则说，"]}],["$","code","1",{"children":["1.0.0.0/8"]}]," ",["$","span","2",{"className":"cjk","children":["的流量不走"]}]," ","Warp，那么"," ","Warp"," ",["$","span","3",{"className":"cjk","children":["就必须让这个路由表"]}]," ",["$","q","4",{"children":[["$","span","0",{"className":"cjk","children":["分裂"]}]]}],["$","span","5",{"className":"cjk","children":["："]}]]}],["$","div",null,{"className":"border border-solid rounded-md not-prose border-zinc-400 relative","children":[["$","$L18",null,{"code":["0.0.0.0/8 dev CloudflareWARP proto static scope link\n2.0.0.0/7 dev CloudflareWARP proto static scope link\n4.0.0.0/6 dev CloudflareWARP proto static scope link\n8.0.0.0/5 dev CloudflareWARP proto static scope link\n16.0.0.0/4 dev CloudflareWARP proto static scope link\n32.0.0.0/3 dev CloudflareWARP proto static scope link\n64.0.0.0/2 dev CloudflareWARP proto static scope link\n128.0.0.0/1 dev CloudflareWARP proto static scope link"]}],["$","pre",null,{"style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","margin":".5em 0","overflow":"auto","background":"var(--theme-background-color)"},"children":["$","code",null,{"className":"language-bash","style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","line-number--1",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[1]}],["$","span","code-segement1",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0.0"]}],["$","span","code-segement2",{"className":"$undefined","style":{},"children":[".0.0/8 dev CloudflareWARP proto static scope "]}],["$","span","code-segement3",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement4",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--2",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[2]}],["$","span","code-segement6",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement7",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["2.0"]}],["$","span","code-segement8",{"className":"$undefined","style":{},"children":[".0.0/7 dev CloudflareWARP proto static scope "]}],["$","span","code-segement9",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement10",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--3",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[3]}],["$","span","code-segement12",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement13",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["4.0"]}],["$","span","code-segement14",{"className":"$undefined","style":{},"children":[".0.0/6 dev CloudflareWARP proto static scope "]}],["$","span","code-segement15",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement16",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--4",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[4]}],["$","span","code-segement18",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement19",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["8.0"]}],["$","span","code-segement20",{"className":"$undefined","style":{},"children":[".0.0/5 dev CloudflareWARP proto static scope "]}],["$","span","code-segement21",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement22",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--5",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[5]}],["$","span","code-segement24",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement25",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["16.0"]}],["$","span","code-segement26",{"className":"$undefined","style":{},"children":[".0.0/4 dev CloudflareWARP proto static scope "]}],["$","span","code-segement27",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement28",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--6",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[6]}],["$","span","code-segement30",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement31",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["32.0"]}],["$","span","code-segement32",{"className":"$undefined","style":{},"children":[".0.0/3 dev CloudflareWARP proto static scope "]}],["$","span","code-segement33",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement34",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--7",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[7]}],["$","span","code-segement36",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement37",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["64.0"]}],["$","span","code-segement38",{"className":"$undefined","style":{},"children":[".0.0/2 dev CloudflareWARP proto static scope "]}],["$","span","code-segement39",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}],["$","span","code-segement40",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--8",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[8]}],["$","span","code-segement42",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement43",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["128.0"]}],["$","span","code-segement44",{"className":"$undefined","style":{},"children":[".0.0/1 dev CloudflareWARP proto static scope "]}],["$","span","code-segement45",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["link"]}]]]}]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["也就是说，"]}],["$","code","1",{"children":["1.0.0.0/8"]}]," ",["$","span","2",{"className":"cjk","children":["被排除在了这张表里，所以它就不会被"]}]," ","Warp"," ",["$","span","3",{"className":"cjk","children":["所路由，会被重新分配给"]}]," ",["$","code","4",{"children":["ip rule"]}]," ",["$","span","5",{"className":"cjk","children":["的下一条规则，也就是"]}]," ",["$","code","6",{"children":["main"]}]," ",["$","span","7",{"className":"cjk","children":["表进行路由。可以看到，这样的减法每次都可能产生一堆"]}]," ","CIDR"," ",["$","span","8",{"className":"cjk","children":["块。"]}]]}],["$","h2",null,{"className":"text-3xl","id":"不可行的方案","children":[["$","$L17",null,{"href":"#不可行的方案","color":"secondary","className":"pr-3 no-underline hover:underline text-primary font-sans","children":"#"}],[["$","span","0",{"className":"cjk","children":["不可行的方案"]}]]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["根据以上的知识，一个直觉的解决方案是，添加一个优先级更高的路由规则，然后把大陆"]}]," ","IP"," ",["$","span","1",{"className":"cjk","children":["全部添加到这个规则指向的路由表里："]}]]}],["$","div",null,{"className":"border border-solid rounded-md not-prose border-zinc-400 relative","children":[["$","$L18",null,{"code":["❯ ip rule\n0:      from all lookup local\n32764:  from all lookup 10000\n32765:  not from all fwmark 0x100cf lookup 65743\n32766:  from all lookup main\n32767:  from all lookup default"]}],["$","pre",null,{"style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","margin":".5em 0","overflow":"auto","background":"var(--theme-background-color)"},"children":["$","code",null,{"className":"language-bash","style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","line-number--1",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[1]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["❯ "]}],["$","span","code-segement2",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["ip"]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":[" rule\n"]}],["$","span","line-number--2",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[2]}],["$","span","code-segement5",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement6",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0"]}],["$","span","code-segement7",{"className":"$undefined","style":{},"children":[":      from all lookup "]}],["$","span","code-segement8",{"className":"token","style":{"color":"var(--theme-class-name-color)","textDecoration":"underline"},"children":["local"]}],["$","span","code-segement9",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--3",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[3]}],["$","span","code-segement11",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement12",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["32764"]}],["$","span","code-segement13",{"className":"$undefined","style":{},"children":[":  from all lookup "]}],["$","span","code-segement14",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10000"]}],["$","span","code-segement15",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--4",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[4]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement18",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["32765"]}],["$","span","code-segement19",{"className":"$undefined","style":{},"children":[":  not from all fwmark 0x100cf lookup "]}],["$","span","code-segement20",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["65743"]}],["$","span","code-segement21",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--5",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[5]}],["$","span","code-segement23",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement24",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["32766"]}],["$","span","code-segement25",{"className":"$undefined","style":{},"children":[":  from all lookup main\n"]}],["$","span","line-number--6",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[6]}],["$","span","code-segement27",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement28",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["32767"]}],["$","span","code-segement29",{"className":"$undefined","style":{},"children":[":  from all lookup default"]}]]]}]}]]}],["$","p",null,{"children":["然而这是不可行的。第一个原因是，Warp"," ",["$","span","0",{"className":"cjk","children":["在每次重连时会非常傲娇地覆盖我们设置的规则，重连以后的情况可能是："]}]]}],["$","div",null,{"className":"border border-solid rounded-md not-prose border-zinc-400 relative","children":[["$","$L18",null,{"code":["❯ ip rule\n0:      from all lookup local\n32763:  not from all fwmark 0x100cf lookup 65743\n32764:  from all lookup 10000\n32765:  not from all fwmark 0x100cf lookup 65743\n32766:  from all lookup main\n32767:  from all lookup default"]}],["$","pre",null,{"style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","margin":".5em 0","overflow":"auto","background":"var(--theme-background-color)"},"children":["$","code",null,{"className":"language-bash","style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","line-number--1",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[1]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["❯ "]}],["$","span","code-segement2",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["ip"]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":[" rule\n"]}],["$","span","line-number--2",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[2]}],["$","span","code-segement5",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement6",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0"]}],["$","span","code-segement7",{"className":"$undefined","style":{},"children":[":      from all lookup "]}],["$","span","code-segement8",{"className":"token","style":{"color":"var(--theme-class-name-color)","textDecoration":"underline"},"children":["local"]}],["$","span","code-segement9",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--3",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[3]}],["$","span","code-segement11",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement12",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["32763"]}],["$","span","code-segement13",{"className":"$undefined","style":{},"children":[":  not from all fwmark 0x100cf lookup "]}],["$","span","code-segement14",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["65743"]}],["$","span","code-segement15",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--4",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[4]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement18",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["32764"]}],["$","span","code-segement19",{"className":"$undefined","style":{},"children":[":  from all lookup "]}],["$","span","code-segement20",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["10000"]}],["$","span","code-segement21",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--5",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[5]}],["$","span","code-segement23",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement24",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["32765"]}],["$","span","code-segement25",{"className":"$undefined","style":{},"children":[":  not from all fwmark 0x100cf lookup "]}],["$","span","code-segement26",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["65743"]}],["$","span","code-segement27",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--6",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[6]}],["$","span","code-segement29",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement30",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["32766"]}],["$","span","code-segement31",{"className":"$undefined","style":{},"children":[":  from all lookup main\n"]}],["$","span","line-number--7",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[7]}],["$","span","code-segement33",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement34",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["32767"]}],["$","span","code-segement35",{"className":"$undefined","style":{},"children":[":  from all lookup default"]}]]]}]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["第二个原因是，在不知不觉之间，本机防火墙的"]}]," ","OUTPUT"," ",["$","span","1",{"className":"cjk","children":["链已经被"]}]," ","Warp"," ",["$","span","2",{"className":"cjk","children":["设下了非常强的规则。"]}]]}],["$","div",null,{"className":"border border-solid rounded-md not-prose border-zinc-400 relative","children":[["$","$L18",null,{"code":["$19"]}],["$","pre",null,{"style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","margin":".5em 0","overflow":"auto","background":"var(--theme-background-color)"},"children":["$","code",null,{"className":"language-bash","style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","line-number--1",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[1]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["❯ "]}],["$","span","code-segement2",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["sudo"]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":[" nft list table inet cloudflare-warp\n"]}],["$","span","line-number--2",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[2]}],["$","span","code-segement5",{"className":"$undefined","style":{},"children":["table inet cloudflare-warp "]}],["$","span","code-segement6",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":["{"]}],["$","span","code-segement7",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--3",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[3]}],["$","span","code-segement9",{"className":"$undefined","style":{},"children":["        chain input "]}],["$","span","code-segement10",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":["{"]}],["$","span","code-segement11",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--4",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[4]}],["$","span","code-segement13",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segement14",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":[".."]}],["$","span","code-segement15",{"className":"$undefined","style":{},"children":[".\n"]}],["$","span","line-number--5",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[5]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segement18",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":["}"]}],["$","span","code-segement19",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--6",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[6]}],"\n",["$","span","line-number--7",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[7]}],["$","span","code-segement23",{"className":"$undefined","style":{},"children":["        chain output "]}],["$","span","code-segement24",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":["{"]}],["$","span","code-segement25",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--8",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[8]}],["$","span","code-segement27",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement28",{"className":"token","style":{"color":"var(--theme-class-name-color)","textDecoration":"underline"},"children":["type"]}],["$","span","code-segement29",{"className":"$undefined","style":{},"children":[" filter hook output priority filter"]}],["$","span","code-segement30",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":[";"]}],["$","span","code-segement31",{"className":"$undefined","style":{},"children":[" policy drop"]}],["$","span","code-segement32",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":[";"]}],["$","span","code-segement33",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--9",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[9]}],["$","span","code-segement35",{"className":"$undefined","style":{},"children":["                oif "]}],["$","span","code-segement36",{"className":"token","style":{"color":"var(--theme-string-color)"},"children":["\"lo\""]}],["$","span","code-segement37",{"className":"$undefined","style":{},"children":[" accept\n"]}],["$","span","line-number--10",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[10]}],["$","span","code-segement39",{"className":"$undefined","style":{},"children":["                oif "]}],["$","span","code-segement40",{"className":"token","style":{"color":"var(--theme-string-color)"},"children":["\"CloudflareWARP\""]}],["$","span","code-segement41",{"className":"$undefined","style":{},"children":[" goto tun\n"]}],["$","span","line-number--11",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[11]}],["$","span","code-segement43",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement44",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["ip"]}],["$","span","code-segement45",{"className":"$undefined","style":{},"children":[" saddr "]}],["$","span","code-segement46",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["0.0"]}],["$","span","code-segement47",{"className":"$undefined","style":{},"children":[".0.0 "]}],["$","span","code-segement48",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["ip"]}],["$","span","code-segement49",{"className":"$undefined","style":{},"children":[" daddr "]}],["$","span","code-segement50",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["255.255"]}],["$","span","code-segement51",{"className":"$undefined","style":{},"children":[".255.255 udp sport "]}],["$","span","code-segement52",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["68"]}],["$","span","code-segement53",{"className":"$undefined","style":{},"children":[" udp dport "]}],["$","span","code-segement54",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["67"]}],["$","span","code-segement55",{"className":"$undefined","style":{},"children":[" accept\n"]}],["$","span","line-number--12",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[12]}],["$","span","code-segement57",{"className":"$undefined","style":{},"children":["                meta nfproto ipv4 udp sport "]}],["$","span","code-segement58",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["67"]}],["$","span","code-segement59",{"className":"$undefined","style":{},"children":[" udp dport "]}],["$","span","code-segement60",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["68"]}],["$","span","code-segement61",{"className":"$undefined","style":{},"children":[" accept\n"]}],["$","span","line-number--13",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[13]}],["$","span","code-segement63",{"className":"$undefined","style":{},"children":["                ip6 saddr fe80::/10 ip6 daddr ff02::1:2 udp sport "]}],["$","span","code-segement64",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["546"]}],["$","span","code-segement65",{"className":"$undefined","style":{},"children":[" udp dport "]}],["$","span","code-segement66",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["547"]}],["$","span","code-segement67",{"className":"$undefined","style":{},"children":[" accept\n"]}],["$","span","line-number--14",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[14]}],["$","span","code-segement69",{"className":"$undefined","style":{},"children":["                ip6 saddr fe80::/10 ip6 daddr ff05::1:3 udp sport "]}],["$","span","code-segement70",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["546"]}],["$","span","code-segement71",{"className":"$undefined","style":{},"children":[" udp dport "]}],["$","span","code-segement72",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["547"]}],["$","span","code-segement73",{"className":"$undefined","style":{},"children":[" accept\n"]}],["$","span","line-number--15",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[15]}],["$","span","code-segement75",{"className":"$undefined","style":{},"children":["                ip6 saddr fe80::/10 ip6 daddr fe80::/10 udp sport "]}],["$","span","code-segement76",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["547"]}],["$","span","code-segement77",{"className":"$undefined","style":{},"children":[" udp dport "]}],["$","span","code-segement78",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["546"]}],["$","span","code-segement79",{"className":"$undefined","style":{},"children":[" accept\n"]}],["$","span","line-number--16",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[16]}],"                meta l4proto ipv6-icmp accept\n",["$","span","line-number--17",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[17]}],["$","span","code-segement83",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement84",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["ip"]}],["$","span","code-segement85",{"className":"$undefined","style":{},"children":[" daddr "]}],["$","span","code-segement86",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["162.159"]}],["$","span","code-segement87",{"className":"$undefined","style":{},"children":[".137.105 tcp dport "]}],["$","span","code-segement88",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["443"]}],["$","span","code-segement89",{"className":"$undefined","style":{},"children":[" accept\n"]}],["$","span","line-number--18",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[18]}],["$","span","code-segement91",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement92",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":[".."]}],["$","span","code-segement93",{"className":"$undefined","style":{},"children":[".\n"]}],["$","span","line-number--19",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[19]}],"                reject\n",["$","span","line-number--20",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[20]}],["$","span","code-segement97",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segement98",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":["}"]}],["$","span","code-segement99",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--21",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[21]}],"\n",["$","span","line-number--22",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[22]}],["$","span","code-segement103",{"className":"$undefined","style":{},"children":["        chain tun "]}],["$","span","code-segement104",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":["{"]}],["$","span","code-segement105",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--23",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[23]}],["$","span","code-segement107",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement108",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["ip"]}],["$","span","code-segement109",{"className":"$undefined","style":{},"children":[" saddr "]}],["$","span","code-segement110",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["172.16"]}],["$","span","code-segement111",{"className":"$undefined","style":{},"children":[".0.2 accept\n"]}],["$","span","line-number--24",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[24]}],["$","span","code-segement113",{"className":"$undefined","style":{},"children":["                ip6 saddr "]}],["$","span","code-segement114",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["2606"]}],["$","span","code-segement115",{"className":"$undefined","style":{},"children":[":4700:110:8dcf:a1af:2f13:73f3:426d accept\n"]}],["$","span","line-number--25",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[25]}],"                ip6 saddr fe80::/10 accept\n",["$","span","line-number--26",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[26]}],["$","span","code-segement119",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement120",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["ip"]}],["$","span","code-segement121",{"className":"$undefined","style":{},"children":[" protocol tcp reject with tcp reset\n"]}],["$","span","line-number--27",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[27]}],"                reject\n",["$","span","line-number--28",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[28]}],["$","span","code-segement125",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segement126",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":["}"]}],["$","span","code-segement127",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","line-number--29",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[29]}],["$","span","code-segement129",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement130",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":["}"]}]]]}]}]]}],["$","p",null,{"children":["这些规则的意思是，只有下列三种报文可以被发出:"]}],["$","ul","45",{"children":[["$","li","0",{"children":[["$","span","0",{"className":"cjk","children":["目的地址属于"]}]," ","Split"," ","Tunnel"," ",["$","span","1",{"className":"cjk","children":["里定义的不走"]}]," ","Warp"," ",["$","span","2",{"className":"cjk","children":["的范围内"]}]]}],["$","li","1",{"children":[["$","span","0",{"className":"cjk","children":["目标接口是"]}]," ","CloudflareWARP"," ",["$","span","1",{"className":"cjk","children":["接口"]}]]}],["$","li","2",{"children":["其他特殊情况，比如本机的流量、dhcp"," ",["$","span","0",{"className":"cjk","children":["等等"]}]]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["结果是，我们这样"]}]," ",["$","q","1",{"children":[["$","span","0",{"className":"cjk","children":["绕过"]}]]}]," ",["$","span","2",{"className":"cjk","children":["的流量自然会被"]}]," ","reject"," ",["$","span","3",{"className":"cjk","children":["掉。我觉得最好还是不要和"]}]," ","Warp"," ",["$","span","4",{"className":"cjk","children":["对着干，所以也不倾向于修改这些规则。值得一提的是，这些规则通过通常的"]}]," ",["$","code","5",{"children":["iptables"]}]," ","命令是看不到的（iptables"," ",["$","span","6",{"className":"cjk","children":["不支持自定义表，而"]}]," ","nftables"," ",["$","span","7",{"className":"cjk","children":["支持），必须通过"]}]," ",["$","code","8",{"children":["nft"]}]," ",["$","span","9",{"className":"cjk","children":["命令来查看。"]}]]}],["$","h2",null,{"className":"text-3xl","id":"最终方案","children":[["$","$L17",null,{"href":"#最终方案","color":"secondary","className":"pr-3 no-underline hover:underline text-primary font-sans","children":"#"}],[["$","span","0",{"className":"cjk","children":["最终方案"]}]]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["当我们的服务器作为其他设备的"]}]," ","VPN"," ","服务器的时候，它本身承担了类似于路由器的功能。也就是说，VPN"," ",["$","span","1",{"className":"cjk","children":["容器的流量其实是被"]}]," ",["$","q","2",{"children":[["$","span","0",{"className":"cjk","children":["转发"]}]]}]," ",["$","span","3",{"className":"cjk","children":["出去了。"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["换句话说，这些流量不会走"]}]," ","OUTPUT"," ",["$","span","1",{"className":"cjk","children":["链，因为"]}]," ","OUTPUT"," ",["$","span","2",{"className":"cjk","children":["链过滤的是本机运行的程序所发送的流量。这无疑给了我们一些暗示：至少可以在"]}]," ","iptables"," ",["$","span","3",{"className":"cjk","children":["内部对"]}]," ","VPN"," ",["$","span","4",{"className":"cjk","children":["容器发出的流量做分流。"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["还记得之前的"]}]," ",["$","code","1",{"children":["0x100cf"]}]," ",["$","span","2",{"className":"cjk","children":["标记吗？只要这个标记被打上了，流量就不会走"]}]," ","Warp."," ",["$","span","3",{"className":"cjk","children":["那么，只要在"]}]," ","PREROUTING"," ",["$","span","4",{"className":"cjk","children":["链里面给源地址在国内的流量打上标记，似乎就能完成任务了，例如："]}]]}],["$","div",null,{"className":"border border-solid rounded-md not-prose border-zinc-400 relative","children":[["$","$L18",null,{"code":["iptables -D PREROUTING -t mangle -d 114.212.0.0/16 -j MARK --set-mark 0x100cf"]}],["$","pre",null,{"style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","margin":".5em 0","overflow":"auto","background":"var(--theme-background-color)"},"children":["$","code",null,{"className":"language-bash","style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","line-number--1",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[1]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["iptables -D PREROUTING -t mangle -d "]}],["$","span","code-segement2",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["114.212"]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":[".0.0/16 -j MARK --set-mark 0x100cf"]}]]]}]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["然而国内的"]}]," ","IP"," ",["$","span","1",{"className":"cjk","children":["段实在是太多了，必须写一个程序来完成这些操作。另一个问题是，当你把这些"]}]," ","CIDR"," ",["$","span","2",{"className":"cjk","children":["全都加进去（大概有"]}]," ","10000"," ",["$","span","3",{"className":"cjk","children":["个左右），你会发现系统的网络性能劣化到了惊人的程度。"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["这是因为"]}]," ","iptables"," ",["$","span","1",{"className":"cjk","children":["的匹配是纯粹的线性匹配，它会一条条检查规则是否被满足，这样任何的数据包都会需要"]}]," ","10000"," ",["$","span","2",{"className":"cjk","children":["次匹配，这会严重影响吞吐量。"]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["所以，应该使用"]}]," ",["$","code","1",{"children":["ipset"]}]," ",["$","span","2",{"className":"cjk","children":["创建一个"]}]," ","CIDR"," ",["$","span","3",{"className":"cjk","children":["的集合，（基于哈希表的）集合匹配就相对快速了："]}]]}],["$","div",null,{"className":"border border-solid rounded-md not-prose border-zinc-400 relative","children":[["$","$L18",null,{"code":["ipset create cn hash:net family inet\nipset add cn 114.212.0.0/16\n...\n\niptables -D PREROUTING -t mangle -m --match-set cn dst -j MARK --set-mark 0x100cf"]}],["$","pre",null,{"style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","margin":".5em 0","overflow":"auto","background":"var(--theme-background-color)"},"children":["$","code",null,{"className":"language-bash","style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","line-number--1",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[1]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["ipset create cn hash:net family inet\n"]}],["$","span","line-number--2",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[2]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":["ipset "]}],["$","span","code-segement4",{"className":"token","style":{"color":"var(--theme-function-color)"},"children":["add"]}],["$","span","code-segement5",{"className":"$undefined","style":{},"children":[" cn "]}],["$","span","code-segement6",{"className":"token","style":{"color":"var(--theme-number-color)"},"children":["114.212"]}],["$","span","code-segement7",{"className":"$undefined","style":{},"children":[".0.0/16\n"]}],["$","span","line-number--3",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[3]}],["$","span","code-segement9",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement10",{"className":"token","style":{"color":"var(--theme-punctuation-color)"},"children":[".."]}],["$","span","code-segement11",{"className":"$undefined","style":{},"children":[".\n"]}],["$","span","line-number--4",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[4]}],"\n",["$","span","line-number--5",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[5]}],"iptables -D PREROUTING -t mangle -m --match-set cn dst -j MARK --set-mark 0x100cf"]]}]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["我写了一个"]}]," ",["$","a","1",{"href":"https://gist.github.com/ayanamists/bb194f497b8f13fcced5d5c3550c2aa8","children":["Python"," ",["$","span","0",{"className":"cjk","children":["程序"]}]]}],["$","span","2",{"className":"cjk","children":["来执行创建和添加任务，以及一个"]}]," ","systemd"," ",["$","span","3",{"className":"cjk","children":["任务，使得每次开机自动执行该任务："]}]]}],["$","div",null,{"className":"border border-solid rounded-md not-prose border-zinc-400 relative","children":[["$","$L18",null,{"code":["[Unit]\nDescription=Init the network settings, will take quite long time\nAfter=network.target\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nExecStart=/usr/bin/python3 /home/ayanamists/service/route/main.py\n\n[Install]\nWantedBy=multi-user.target"]}],["$","pre",null,{"style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","margin":".5em 0","overflow":"auto","background":"var(--theme-background-color)"},"children":["$","code",null,{"className":"language-service","style":{"color":"var(--theme-code-color)","textShadow":"0 1px var(--theme-text-shadow-color)","fontFamily":"Mononoki, 'Mononoki Nerd Font', FiraCode, 'FiraCode Nerd Font', JetBrainsMono, 'JetBrainsMono Nerd Font', Menlo, Monaco, monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","line-number--1",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[1]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["[Unit]\n"]}],["$","span","line-number--2",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[2]}],"Description=Init the network settings, will take quite long time\n",["$","span","line-number--3",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[3]}],"After=network.target\n",["$","span","line-number--4",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[4]}],"\n",["$","span","line-number--5",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[5]}],"[Service]\n",["$","span","line-number--6",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[6]}],"Type=oneshot\n",["$","span","line-number--7",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[7]}],"RemainAfterExit=yes\n",["$","span","line-number--8",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[8]}],"ExecStart=/usr/bin/python3 /home/ayanamists/service/route/main.py\n",["$","span","line-number--9",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[9]}],"\n",["$","span","line-number--10",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[10]}],"[Install]\n",["$","span","line-number--11",{"className":"linenumber react-syntax-highlighter-line-number","style":{"display":"inline-block","minWidth":"1.6em","paddingRight":"0","textAlign":"right","userSelect":"none","marginRight":"1.5em","fontStyle":"italic","color":"var(--theme-comment-color)"},"children":[11]}],"WantedBy=multi-user.target"]]}]}]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["虽然这里有一些"]}]," ",["$","q","1",{"children":[["$","span","0",{"className":"cjk","children":["医者不能自医"]}]]}]," ",["$","span","2",{"className":"cjk","children":["的尴尬，服务器本身还是没有实现分流，但是这也是一个不错的解决方案了。"]}]]}],["$","h2",null,{"className":"text-3xl","id":"总结","children":[["$","$L17",null,{"href":"#总结","color":"secondary","className":"pr-3 no-underline hover:underline text-primary font-sans","children":"#"}],[["$","span","0",{"className":"cjk","children":["总结"]}]]]}],["$","p",null,{"children":[["$","span","0",{"className":"cjk","children":["经过以上配置，我能够在校园的任何一个地方安全地访问到我的服务器，并且实现了比较流畅的网络体验。我一直有个想法，一个程序员单枪匹马改变世界的时代已经过去了，但至少，我们应该改变我们的生活，用技术让生活更加美好。"]}]]}],["$","h2",null,{"className":"text-3xl","id":"参考资料","children":[["$","$L17",null,{"href":"#参考资料","color":"secondary","className":"pr-3 no-underline hover:underline text-primary font-sans","children":"#"}],[["$","span","0",{"className":"cjk","children":["参考资料"]}]]]}],["$","ul","62",{"children":[["$","li","0",{"children":[["$","a","0",{"href":"https://man7.org/linux/man-pages/man8/ip-rule.8.html","children":["ip"," ","rule"," ",["$","span","0",{"className":"cjk","children":["的文档"]}]]}]]}],["$","li","1",{"children":[["$","a","0",{"href":"https://upload.wikimedia.org/wikipedia/commons/3/37/Netfilter-packet-flow.svg","children":["iptables"," ",["$","span","0",{"className":"cjk","children":["的图解"]}]]}]]}]]}],["$","div",null,{"className":"notes","children":"$undefined"}]]}]]}]]}]
